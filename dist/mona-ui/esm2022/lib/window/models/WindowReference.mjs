import { asapScheduler, map, Subject } from "rxjs";
import { WindowCloseEvent } from "./WindowCloseEvent";
import { PopupCloseSource } from "../../popup/models/PopupCloseEvent";
import { WindowRef } from "./WindowRef";
/**
 * @internal - used by WindowService. Do not export.
 */
export class WindowReference {
    constructor(options) {
        this.options = options;
        // public readonly popupReference: PopupRef;
        this.move$ = new Subject();
        this.resize$ = new Subject();
    }
    center() {
        const width = this.options.popupRef.overlayRef.overlayElement.offsetWidth;
        const height = this.options.popupRef.overlayRef.overlayElement.offsetHeight;
        const left = (window.innerWidth - width) / 2;
        const top = (window.innerHeight - height) / 2;
        this.options.popupRef.overlayRef.overlayElement.style.left = `${left}px`;
        this.options.popupRef.overlayRef.overlayElement.style.top = `${top}px`;
    }
    close(result) {
        const event = result instanceof WindowCloseEvent
            ? result
            : new WindowCloseEvent({ result, via: PopupCloseSource.Programmatic });
        this.options.popupRef.close(event);
    }
    move(params) {
        if (params.top) {
            this.options.popupRef.overlayRef.overlayElement.style.top = `${params.top}px`;
        }
        if (params.left) {
            this.options.popupRef.overlayRef.overlayElement.style.left = `${params.left}px`;
        }
    }
    resize(params) {
        if (params.width) {
            this.options.popupRef.overlayRef.overlayElement.style.width = `${params.width}px`;
        }
        if (params.height) {
            this.options.popupRef.overlayRef.overlayElement.style.height = `${params.height}px`;
        }
        if (params.center) {
            asapScheduler.schedule(() => this.center());
        }
    }
    get closed$() {
        return this.options.popupRef.closed.pipe(map(event => {
            if (event.type === "windowClose") {
                return event;
            }
            return new WindowCloseEvent({ event, via: event.via, type: "windowClose", result: event.result });
        }));
    }
    get component() {
        // Type of component is ComponentRef<WindowContentComponent>. It is set as any to avoid circular dependency.
        return this.popupRef.component.instance.componentRef ?? null;
    }
    get element() {
        return this.options.popupRef.overlayRef.overlayElement;
    }
    get moved$() {
        return this.move$;
    }
    get popupRef() {
        return this.options.popupRef;
    }
    get resized$() {
        return this.resize$;
    }
    get windowRef() {
        return new WindowRef(this);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiV2luZG93UmVmZXJlbmNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvbW9uYS11aS9zcmMvbGliL3dpbmRvdy9tb2RlbHMvV2luZG93UmVmZXJlbmNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxhQUFhLEVBQUUsR0FBRyxFQUFjLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUkvRCxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUN0RCxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxvQ0FBb0MsQ0FBQztBQUV0RSxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sYUFBYSxDQUFDO0FBSXhDOztHQUVHO0FBQ0gsTUFBTSxPQUFPLGVBQWU7SUFLeEIsWUFBb0MsT0FBK0I7UUFBL0IsWUFBTyxHQUFQLE9BQU8sQ0FBd0I7UUFKbkUsNENBQTRDO1FBQzVCLFVBQUssR0FBdUIsSUFBSSxPQUFPLEVBQWEsQ0FBQztRQUNyRCxZQUFPLEdBQXlCLElBQUksT0FBTyxFQUFlLENBQUM7SUFFTCxDQUFDO0lBRWhFLE1BQU07UUFDVCxNQUFNLEtBQUssR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsY0FBYyxDQUFDLFdBQVcsQ0FBQztRQUMxRSxNQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsY0FBYyxDQUFDLFlBQVksQ0FBQztRQUM1RSxNQUFNLElBQUksR0FBRyxDQUFDLE1BQU0sQ0FBQyxVQUFVLEdBQUcsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQzdDLE1BQU0sR0FBRyxHQUFHLENBQUMsTUFBTSxDQUFDLFdBQVcsR0FBRyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDOUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLGNBQWMs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ZixPQUFPLElBQUksQ0FBQyxPQUFPLENBQUM7SUFDeEIsQ0FBQztJQUVELElBQVcsU0FBUztRQUNoQixPQUFPLElBQUksU0FBUyxDQUFJLElBQUksQ0FBQyxDQUFDO0lBQ2xDLENBQUM7Q0FDSiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGFzYXBTY2hlZHVsZXIsIG1hcCwgT2JzZXJ2YWJsZSwgU3ViamVjdCB9IGZyb20gXCJyeGpzXCI7XG5pbXBvcnQgeyBNb3ZlRXZlbnQgfSBmcm9tIFwiLi9Nb3ZlRXZlbnRcIjtcbmltcG9ydCB7IFJlc2l6ZUV2ZW50IH0gZnJvbSBcIi4vUmVzaXplRXZlbnRcIjtcbmltcG9ydCB7IFBvcHVwUmVmIH0gZnJvbSBcIi4uLy4uL3BvcHVwL21vZGVscy9Qb3B1cFJlZlwiO1xuaW1wb3J0IHsgV2luZG93Q2xvc2VFdmVudCB9IGZyb20gXCIuL1dpbmRvd0Nsb3NlRXZlbnRcIjtcbmltcG9ydCB7IFBvcHVwQ2xvc2VTb3VyY2UgfSBmcm9tIFwiLi4vLi4vcG9wdXAvbW9kZWxzL1BvcHVwQ2xvc2VFdmVudFwiO1xuaW1wb3J0IHsgQ29tcG9uZW50UmVmIH0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcbmltcG9ydCB7IFdpbmRvd1JlZiB9IGZyb20gXCIuL1dpbmRvd1JlZlwiO1xuaW1wb3J0IHsgV2luZG93UmVmUGFyYW1zIH0gZnJvbSBcIi4vV2luZG93UmVmUGFyYW1zXCI7XG5pbXBvcnQgeyBXaW5kb3dSZWZlcmVuY2VPcHRpb25zIH0gZnJvbSBcIi4vV2luZG93UmVmZXJlbmNlT3B0aW9uc1wiO1xuXG4vKipcbiAqIEBpbnRlcm5hbCAtIHVzZWQgYnkgV2luZG93U2VydmljZS4gRG8gbm90IGV4cG9ydC5cbiAqL1xuZXhwb3J0IGNsYXNzIFdpbmRvd1JlZmVyZW5jZTxSID0gdW5rbm93bj4gaW1wbGVtZW50cyBXaW5kb3dSZWZQYXJhbXM8Uj4ge1xuICAgIC8vIHB1YmxpYyByZWFkb25seSBwb3B1cFJlZmVyZW5jZTogUG9wdXBSZWY7XG4gICAgcHVibGljIHJlYWRvbmx5IG1vdmUkOiBTdWJqZWN0PE1vdmVFdmVudD4gPSBuZXcgU3ViamVjdDxNb3ZlRXZlbnQ+KCk7XG4gICAgcHVibGljIHJlYWRvbmx5IHJlc2l6ZSQ6IFN1YmplY3Q8UmVzaXplRXZlbnQ+ID0gbmV3IFN1YmplY3Q8UmVzaXplRXZlbnQ+KCk7XG5cbiAgICBwdWJsaWMgY29uc3RydWN0b3IocHJpdmF0ZSByZWFkb25seSBvcHRpb25zOiBXaW5kb3dSZWZlcmVuY2VPcHRpb25zKSB7fVxuXG4gICAgcHVibGljIGNlbnRlcigpOiB2b2lkIHtcbiAgICAgICAgY29uc3Qgd2lkdGggPSB0aGlzLm9wdGlvbnMucG9wdXBSZWYub3ZlcmxheVJlZi5vdmVybGF5RWxlbWVudC5vZmZzZXRXaWR0aDtcbiAgICAgICAgY29uc3QgaGVpZ2h0ID0gdGhpcy5vcHRpb25zLnBvcHVwUmVmLm92ZXJsYXlSZWYub3ZlcmxheUVsZW1lbnQub2Zmc2V0SGVpZ2h0O1xuICAgICAgICBjb25zdCBsZWZ0ID0gKHdpbmRvdy5pbm5lcldpZHRoIC0gd2lkdGgpIC8gMjtcbiAgICAgICAgY29uc3QgdG9wID0gKHdpbmRvdy5pbm5lckhlaWdodCAtIGhlaWdodCkgLyAyO1xuICAgICAgICB0aGlzLm9wdGlvbnMucG9wdXBSZWYub3ZlcmxheVJlZi5vdmVybGF5RWxlbWVudC5zdHlsZS5sZWZ0ID0gYCR7bGVmdH1weGA7XG4gICAgICAgIHRoaXMub3B0aW9ucy5wb3B1cFJlZi5vdmVybGF5UmVmLm92ZXJsYXlFbGVtZW50LnN0eWxlLnRvcCA9IGAke3RvcH1weGA7XG4gICAgfVxuXG4gICAgcHVibGljIGNsb3NlKHJlc3VsdD86IFIpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgZXZlbnQgPVxuICAgICAgICAgICAgcmVzdWx0IGluc3RhbmNlb2YgV2luZG93Q2xvc2VFdmVudFxuICAgICAgICAgICAgICAgID8gcmVzdWx0XG4gICAgICAgICAgICAgICAgOiBuZXcgV2luZG93Q2xvc2VFdmVudCh7IHJlc3VsdCwgdmlhOiBQb3B1cENsb3NlU291cmNlLlByb2dyYW1tYXRpYyB9KTtcbiAgICAgICAgdGhpcy5vcHRpb25zLnBvcHVwUmVmLmNsb3NlKGV2ZW50KTtcbiAgICB9XG5cbiAgICBwdWJsaWMgbW92ZShwYXJhbXM6IHsgdG9wPzogbnVtYmVyOyBsZWZ0PzogbnVtYmVyIH0pOiB2b2lkIHtcbiAgICAgICAgaWYgKHBhcmFtcy50b3ApIHtcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucy5wb3B1cFJlZi5vdmVybGF5UmVmLm92ZXJsYXlFbGVtZW50LnN0eWxlLnRvcCA9IGAke3BhcmFtcy50b3B9cHhgO1xuICAgICAgICB9XG4gICAgICAgIGlmIChwYXJhbXMubGVmdCkge1xuICAgICAgICAgICAgdGhpcy5vcHRpb25zLnBvcHVwUmVmLm92ZXJsYXlSZWYub3ZlcmxheUVsZW1lbnQuc3R5bGUubGVmdCA9IGAke3BhcmFtcy5sZWZ0fXB4YDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyByZXNpemUocGFyYW1zOiB7IHdpZHRoPzogbnVtYmVyOyBoZWlnaHQ/OiBudW1iZXI7IGNlbnRlcj86IGJvb2xlYW4gfSk6IHZvaWQge1xuICAgICAgICBpZiAocGFyYW1zLndpZHRoKSB7XG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMucG9wdXBSZWYub3ZlcmxheVJlZi5vdmVybGF5RWxlbWVudC5zdHlsZS53aWR0aCA9IGAke3BhcmFtcy53aWR0aH1weGA7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHBhcmFtcy5oZWlnaHQpIHtcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucy5wb3B1cFJlZi5vdmVybGF5UmVmLm92ZXJsYXlFbGVtZW50LnN0eWxlLmhlaWdodCA9IGAke3BhcmFtcy5oZWlnaHR9cHhgO1xuICAgICAgICB9XG4gICAgICAgIGlmIChwYXJhbXMuY2VudGVyKSB7XG4gICAgICAgICAgICBhc2FwU2NoZWR1bGVyLnNjaGVkdWxlKCgpID0+IHRoaXMuY2VudGVyKCkpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIGdldCBjbG9zZWQkKCk6IE9ic2VydmFibGU8V2luZG93Q2xvc2VFdmVudD4ge1xuICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zLnBvcHVwUmVmLmNsb3NlZC5waXBlKFxuICAgICAgICAgICAgbWFwKGV2ZW50ID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoZXZlbnQudHlwZSA9PT0gXCJ3aW5kb3dDbG9zZVwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBldmVudDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBXaW5kb3dDbG9zZUV2ZW50KHsgZXZlbnQsIHZpYTogZXZlbnQudmlhLCB0eXBlOiBcIndpbmRvd0Nsb3NlXCIsIHJlc3VsdDogZXZlbnQucmVzdWx0IH0pO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0IGNvbXBvbmVudCgpOiBDb21wb25lbnRSZWY8YW55PiB8IG51bGwge1xuICAgICAgICAvLyBUeXBlIG9mIGNvbXBvbmVudCBpcyBDb21wb25lbnRSZWY8V2luZG93Q29udGVudENvbXBvbmVudD4uIEl0IGlzIHNldCBhcyBhbnkgdG8gYXZvaWQgY2lyY3VsYXIgZGVwZW5kZW5jeS5cbiAgICAgICAgcmV0dXJuICh0aGlzLnBvcHVwUmVmLmNvbXBvbmVudCBhcyBDb21wb25lbnRSZWY8YW55PikuaW5zdGFuY2UuY29tcG9uZW50UmVmID8/IG51bGw7XG4gICAgfVxuXG4gICAgcHVibGljIGdldCBlbGVtZW50KCk6IEhUTUxFbGVtZW50IHtcbiAgICAgICAgcmV0dXJuIHRoaXMub3B0aW9ucy5wb3B1cFJlZi5vdmVybGF5UmVmLm92ZXJsYXlFbGVtZW50O1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXQgbW92ZWQkKCk6IE9ic2VydmFibGU8TW92ZUV2ZW50PiB7XG4gICAgICAgIHJldHVybiB0aGlzLm1vdmUkO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXQgcG9wdXBSZWYoKTogUG9wdXBSZWYge1xuICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zLnBvcHVwUmVmO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXQgcmVzaXplZCQoKTogT2JzZXJ2YWJsZTxSZXNpemVFdmVudD4ge1xuICAgICAgICByZXR1cm4gdGhpcy5yZXNpemUkO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXQgd2luZG93UmVmKCk6IFdpbmRvd1JlZjxSPiB7XG4gICAgICAgIHJldHVybiBuZXcgV2luZG93UmVmPFI+KHRoaXMpO1xuICAgIH1cbn1cbiJdfQ==