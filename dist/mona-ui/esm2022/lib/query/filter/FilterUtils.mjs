import { DateTime } from "luxon";
export class FilterUtils {
    static compositeDescriptorToPredicate(descriptor, fieldSelector) {
        return (item) => {
            const filters = descriptor.filters;
            const logic = descriptor.logic;
            if (logic === "and") {
                return filters.every(f => {
                    if (f.hasOwnProperty("field")) {
                        return FilterUtils.descriptorToPredicate(f, fieldSelector)(item);
                    }
                    else {
                        return FilterUtils.compositeDescriptorToPredicate(f, fieldSelector)(item);
                    }
                });
            }
            else if (logic === "or") {
                return filters.some(f => {
                    if (f.hasOwnProperty("field")) {
                        return FilterUtils.descriptorToPredicate(f, fieldSelector)(item);
                    }
                    else {
                        return FilterUtils.compositeDescriptorToPredicate(f, fieldSelector)(item);
                    }
                });
            }
            else {
                return false;
            }
        };
    }
    static descriptorToPredicate(descriptor, fieldSelector) {
        return (item) => {
            const value = (fieldSelector ? fieldSelector(item) : item)[descriptor.field];
            switch (descriptor.operator) {
                case "eq":
                    return value == null && descriptor.value == null
                        ? true
                        : (value == null && descriptor.value != null) || (value != null && descriptor.value == null)
                            ? false
                            : value instanceof Date
                                ? DateTime.fromJSDate(value).equals(DateTime.fromJSDate(descriptor.value))
                                : value === descriptor.value;
                case "neq":
                    return value == null && descriptor.value == null
                        ? false
                        : (value == null && descriptor.value != null) || (value != null && descriptor.value == null)
                            ? true
                            : value instanceof Date
                                ? !DateTime.fromJSDate(value).equals(DateTime.fromJSDate(descriptor.value))
                                : value !== descriptor.value;
                case "gt":
                    return value == null || descriptor.value == null ? false : value > descriptor.value;
                case "gte":
                    return value == null || descriptor.value == null ? false : value >= descriptor.value;
                case "lt":
                    return value == null || descriptor.value == null ? false : value < descriptor.value;
                case "lte":
                    return value == null || descriptor.value == null ? false : value <= descriptor.value;
                case "startswith":
                    return value == null || descriptor.value == null ? false : value.startsWith(descriptor.value);
                case "endswith":
                    return value == null || descriptor.value == null ? false : value.endsWith(descriptor.value);
                case "contains":
                    return value == null || descriptor.value == null ? false : value.includes(descriptor.value);
                case "doesnotcontain":
                    return value == null || descriptor.value == null ? false : !value.includes(descriptor.value);
                case "isnull":
                    return value == null;
                case "isnotnull":
                    return value != null;
                case "isempty":
                    return value === "";
                case "isnotempty":
                    return value !== "";
                case "isnullorempty":
                    return value == null || value === "";
                case "isnotnullorempty":
                    return value != null && value !== "";
                case "in":
                    return descriptor.value.includes(value);
                case "notin":
                    return !descriptor.value.includes(value);
                case "function":
                    return descriptor.predicate(value);
                default:
                    return false;
            }
        };
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRmlsdGVyVXRpbHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9tb25hLXVpL3NyYy9saWIvcXVlcnkvZmlsdGVyL0ZpbHRlclV0aWxzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUVBLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxPQUFPLENBQUM7QUFFakMsTUFBTSxPQUFnQixXQUFXO0lBQ3RCLE1BQU0sQ0FBQyw4QkFBOEIsQ0FDeEMsVUFBcUMsRUFDckMsYUFBZ0M7UUFFaEMsT0FBTyxDQUFDLElBQU8sRUFBRSxFQUFFO1lBQ2YsTUFBTSxPQUFPLEdBQUcsVUFBVSxDQUFDLE9BQU8sQ0FBQztZQUNuQyxNQUFNLEtBQUssR0FBRyxVQUFVLENBQUMsS0FBSyxDQUFDO1lBQy9CLElBQUksS0FBSyxLQUFLLEtBQUssRUFBRTtnQkFDakIsT0FBTyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUFFO29CQUNyQixJQUFJLENBQUMsQ0FBQyxjQUFjLENBQUMsT0FBTyxDQUFDLEVBQUU7d0JBQzNCLE9BQU8sV0FBVyxDQUFDLHFCQUFxQixDQUFDLENBQXFCLEVBQUUsYUFBYSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUM7cUJBQ3hGO3lCQUFNO3dCQUNILE9BQU8sV0FBVyxDQUFDLDhCQUE4QixDQUM3QyxDQUE4QixFQUM5QixhQUFhLENBQ2hCLENBQUMsSUFBSSxDQUFDLENBQUM7cUJBQ1g7Z0JBQ0wsQ0FBQyxDQUFDLENBQUM7YUFDTjtpQkFBTSxJQUFJLEtBQUssS0FBSyxJQUFJLEVBQUU7Z0JBQ3ZCLE9BQU8sT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRTtvQkFDcEIsSUFBSSxDQUFDLENBQUMsY0FBYyxDQUFDLE9BQU8sQ0FBQyxFQUFFO3dCQUMzQixPQUFPLFdBQVcsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFxQixFQUFFLGFBQWEsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDO3FCQUN4Rjt5QkFBTTt3QkFDSCxPQUFPLFdBQVcsQ0FBQyw4QkFBOEIsQ0FDN0MsQ0FBOEIsRUFDOUIsYUFBYSxDQUNoQixDQUFDLElBQUksQ0FBQyxDQUFDO3FCQUNYO2dCQUNMLENBQUMsQ0FBQyxDQUFDO2FBQ047aUJBQU07Z0JBQ0gsT0FBTyxLQUFLLENBQUM7YUFDaEI7UUFDTCxDQUFDLENBQUM7SUFDTixDQUFDO0lBQ00sTUFBTSxDQUFDLHFCQUFxQixDQUMvQixVQUE0QixFQUM1QixhQUFnQztRQUVoQyxPQUFPLENBQUMsSUFBTyxFQUFFLEVBQUU7WUFDZixNQUFNLEtBQUssR0FBRyxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBRSxJQUFZLENBQUMsQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDdEYsUUFBUSxVQUFVLENBQUMsUUFBUSxFQUFFO2dCQUN6QixLQUFLLElBQUk7b0JBQ0wsT0FBTyxLQUFLLElBQUksSUFBSSxJQUFJLFVBQVUsQ0FBQyxLQUFLLElBQUksSUFBSTt3QkFDNUMsQ0FBQyxDQUFDLElBQUk7d0JBQ04sQ0FBQyxDQUFDLENBQUMsS0FBSyxJQUFJLElBQUksSUFBSSxVQUFVLENBQUMsS0FBSyxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxJQUFJLElBQUksSUFBSSxVQUFVLENBQUMsS0FBSyxJQUFJLElBQUksQ0FBQzs0QkFDNUYsQ0FBQyxDQUFDLEtBQUs7NEJBQ1AsQ0FBQyxDQUFDLEtBQUssWUFBWSxJQUFJO2dDQUN2QixDQUFDLENBQUMsUUFBUSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLFVBQVUsQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUM7Z0NBQzFFLENBQUMsQ0FBQyxLQUFLLEtBQUssVUFBVSxDQUFDLEtBQUssQ0FBQztnQkFDckMsS0FBSyxLQUFLO29CQUNOLE9BQU8sS0FBSyxJQUFJLElBQUksSUFBSSxVQUFVLENBQUMsS0FBSyxJQUFJLElBQUk7d0JBQzVDLENBQUMsQ0FBQyxLQUFLO3dCQUNQLENBQUMsQ0FBQyxDQUFDLEtBQUssSUFBSSxJQUFJLElBQUksVUFBVSxDQUFDLEtBQUssSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssSUFBSSxJQUFJLElBQUksVUFBVSxDQUFDLEtBQUssSUFBSSxJQUFJLENBQUM7NEJBQzVGLENBQUMsQ0FBQyxJQUFJOzRCQUNOLENBQUMsQ0FBQyxLQUFLLFlBQVksSUFBSTtnQ0FDdkIsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLFVBQVUsQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUM7Z0NBQzNFLENBQUMsQ0FBQyxLQUFLLEtBQUssVUFBVSxDQUFDLEtBQUssQ0FBQztnQkFDckMsS0FBSyxJQUFJO29CQUNMLE9BQU8sS0FBSyxJQUFJLElBQUksSUFBSSxVQUFVLENBQUMsS0FBSyxJQUFJLElBQUksQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxLQUFLLEdBQUcsVUFBVSxDQUFDLEtBQUssQ0FBQztnQkFDeEYsS0FBSyxLQUFLO29CQUNOLE9BQU8sS0FBSyxJQUFJLElBQUksSUFBSSxVQUFVLENBQUMsS0FBSyxJQUFJLElBQUksQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxLQUFLLElBQUksVUFBVSxDQUFDLEtBQUssQ0FBQztnQkFDekYsS0FBSyxJQUFJO29CQUNMLE9BQU8sS0FBSyxJQUFJLElBQUksSUFBSSxVQUFVLENBQUMsS0FBSyxJQUFJLElBQUksQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxLQUFLLEdBQUcsVUFBVSxDQUFDLEtBQUssQ0FBQztnQkFDeEYsS0FBSyxLQUFLO29CQUNOLE9BQU8sS0FBSyxJQUFJLElBQUksSUFBSSxVQUFVLENBQUMsS0FBSyxJQUFJLElBQUksQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxLQUFLLElBQUksVUFBVSxDQUFDLEtBQUssQ0FBQztnQkFDekYsS0FBSyxZQUFZO29CQUNiLE9BQU8sS0FBSyxJQUFJLElBQUksSUFBSSxVQUFVLENBQUMsS0FBSyxJQUFJLElBQUksQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsVUFBVSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQztnQkFDbEcsS0FBSyxVQUFVO29CQUNYLE9BQU8sS0FBSyxJQUFJLElBQUksSUFBSSxVQUFVLENBQUMsS0FBSyxJQUFJLElBQUksQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQztnQkFDaEcsS0FBSyxVQUFVO29CQUNYLE9BQU8sS0FBSyxJQUFJLElBQUksSUFBSSxVQUFVLENBQUMsS0FBSyxJQUFJLElBQUksQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQztnQkFDaEcsS0FBSyxnQkFBZ0I7b0JBQ2pCLE9BQU8sS0FBSyxJQUFJLElBQUksSUFBSSxVQUFVLENBQUMsS0FBSyxJQUFJLElBQUksQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDO2dCQUNqRyxLQUFLLFFBQVE7b0JBQ1QsT0FBTyxLQUFLLElBQUksSUFBSSxDQUFDO2dCQUN6QixLQUFLLFdBQVc7b0JBQ1osT0FBTyxLQUFLLElBQUksSUFBSSxDQUFDO2dCQUN6QixLQUFLLFNBQVM7b0JBQ1YsT0FBTyxLQUFLLEtBQUssRUFBRSxDQUFDO2dCQUN4QixLQUFLLFlBQVk7b0JBQ2IsT0FBTyxLQUFLLEtBQUssRUFBRSxDQUFDO2dCQUN4QixLQUFLLGVBQWU7b0JBQ2hCLE9BQU8sS0FBSyxJQUFJLElBQUksSUFBSSxLQUFLLEtBQUssRUFBRSxDQUFDO2dCQUN6QyxLQUFLLGtCQUFrQjtvQkFDbkIsT0FBTyxLQUFLLElBQUksSUFBSSxJQUFJLEtBQUssS0FBSyxFQUFFLENBQUM7Z0JBQ3pDLEtBQUssSUFBSTtvQkFDTCxPQUFRLFVBQVUsQ0FBQyxLQUFhLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDO2dCQUNyRCxLQUFLLE9BQU87b0JBQ1IsT0FBTyxDQUFFLFVBQVUsQ0FBQyxLQUFhLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDO2dCQUN0RCxLQUFLLFVBQVU7b0JBQ1gsT0FBUSxVQUFVLENBQUMsU0FBMEIsQ0FBQyxLQUFLLENBQUMsQ0FBQztnQkFDekQ7b0JBQ0ksT0FBTyxLQUFLLENBQUM7YUFDcEI7UUFDTCxDQUFDLENBQUM7SUFDTixDQUFDO0NBQ0oiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQcmVkaWNhdGUsIFNlbGVjdG9yIH0gZnJvbSBcIkBtaXJlaS90cy1jb2xsZWN0aW9uc1wiO1xuaW1wb3J0IHsgQ29tcG9zaXRlRmlsdGVyRGVzY3JpcHRvciwgRmlsdGVyRGVzY3JpcHRvciB9IGZyb20gXCIuL0ZpbHRlckRlc2NyaXB0b3JcIjtcbmltcG9ydCB7IERhdGVUaW1lIH0gZnJvbSBcImx1eG9uXCI7XG5cbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBGaWx0ZXJVdGlscyB7XG4gICAgcHVibGljIHN0YXRpYyBjb21wb3NpdGVEZXNjcmlwdG9yVG9QcmVkaWNhdGU8VD4oXG4gICAgICAgIGRlc2NyaXB0b3I6IENvbXBvc2l0ZUZpbHRlckRlc2NyaXB0b3IsXG4gICAgICAgIGZpZWxkU2VsZWN0b3I/OiBTZWxlY3RvcjxULCBhbnk+XG4gICAgKTogUHJlZGljYXRlPFQ+IHtcbiAgICAgICAgcmV0dXJuIChpdGVtOiBUKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBmaWx0ZXJzID0gZGVzY3JpcHRvci5maWx0ZXJzO1xuICAgICAgICAgICAgY29uc3QgbG9naWMgPSBkZXNjcmlwdG9yLmxvZ2ljO1xuICAgICAgICAgICAgaWYgKGxvZ2ljID09PSBcImFuZFwiKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZpbHRlcnMuZXZlcnkoZiA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChmLmhhc093blByb3BlcnR5KFwiZmllbGRcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBGaWx0ZXJVdGlscy5kZXNjcmlwdG9yVG9QcmVkaWNhdGUoZiBhcyBGaWx0ZXJEZXNjcmlwdG9yLCBmaWVsZFNlbGVjdG9yKShpdGVtKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBGaWx0ZXJVdGlscy5jb21wb3NpdGVEZXNjcmlwdG9yVG9QcmVkaWNhdGUoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZiBhcyBDb21wb3NpdGVGaWx0ZXJEZXNjcmlwdG9yLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkU2VsZWN0b3JcbiAgICAgICAgICAgICAgICAgICAgICAgICkoaXRlbSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAobG9naWMgPT09IFwib3JcIikge1xuICAgICAgICAgICAgICAgIHJldHVybiBmaWx0ZXJzLnNvbWUoZiA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChmLmhhc093blByb3BlcnR5KFwiZmllbGRcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBGaWx0ZXJVdGlscy5kZXNjcmlwdG9yVG9QcmVkaWNhdGUoZiBhcyBGaWx0ZXJEZXNjcmlwdG9yLCBmaWVsZFNlbGVjdG9yKShpdGVtKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBGaWx0ZXJVdGlscy5jb21wb3NpdGVEZXNjcmlwdG9yVG9QcmVkaWNhdGUoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZiBhcyBDb21wb3NpdGVGaWx0ZXJEZXNjcmlwdG9yLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkU2VsZWN0b3JcbiAgICAgICAgICAgICAgICAgICAgICAgICkoaXRlbSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH1cbiAgICBwdWJsaWMgc3RhdGljIGRlc2NyaXB0b3JUb1ByZWRpY2F0ZTxUPihcbiAgICAgICAgZGVzY3JpcHRvcjogRmlsdGVyRGVzY3JpcHRvcixcbiAgICAgICAgZmllbGRTZWxlY3Rvcj86IFNlbGVjdG9yPFQsIGFueT5cbiAgICApOiBQcmVkaWNhdGU8VD4ge1xuICAgICAgICByZXR1cm4gKGl0ZW06IFQpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gKGZpZWxkU2VsZWN0b3IgPyBmaWVsZFNlbGVjdG9yKGl0ZW0pIDogKGl0ZW0gYXMgYW55KSlbZGVzY3JpcHRvci5maWVsZF07XG4gICAgICAgICAgICBzd2l0Y2ggKGRlc2NyaXB0b3Iub3BlcmF0b3IpIHtcbiAgICAgICAgICAgICAgICBjYXNlIFwiZXFcIjpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlID09IG51bGwgJiYgZGVzY3JpcHRvci52YWx1ZSA9PSBudWxsXG4gICAgICAgICAgICAgICAgICAgICAgICA/IHRydWVcbiAgICAgICAgICAgICAgICAgICAgICAgIDogKHZhbHVlID09IG51bGwgJiYgZGVzY3JpcHRvci52YWx1ZSAhPSBudWxsKSB8fCAodmFsdWUgIT0gbnVsbCAmJiBkZXNjcmlwdG9yLnZhbHVlID09IG51bGwpXG4gICAgICAgICAgICAgICAgICAgICAgICA/IGZhbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICA6IHZhbHVlIGluc3RhbmNlb2YgRGF0ZVxuICAgICAgICAgICAgICAgICAgICAgICAgPyBEYXRlVGltZS5mcm9tSlNEYXRlKHZhbHVlKS5lcXVhbHMoRGF0ZVRpbWUuZnJvbUpTRGF0ZShkZXNjcmlwdG9yLnZhbHVlKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIDogdmFsdWUgPT09IGRlc2NyaXB0b3IudmFsdWU7XG4gICAgICAgICAgICAgICAgY2FzZSBcIm5lcVwiOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWUgPT0gbnVsbCAmJiBkZXNjcmlwdG9yLnZhbHVlID09IG51bGxcbiAgICAgICAgICAgICAgICAgICAgICAgID8gZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgIDogKHZhbHVlID09IG51bGwgJiYgZGVzY3JpcHRvci52YWx1ZSAhPSBudWxsKSB8fCAodmFsdWUgIT0gbnVsbCAmJiBkZXNjcmlwdG9yLnZhbHVlID09IG51bGwpXG4gICAgICAgICAgICAgICAgICAgICAgICA/IHRydWVcbiAgICAgICAgICAgICAgICAgICAgICAgIDogdmFsdWUgaW5zdGFuY2VvZiBEYXRlXG4gICAgICAgICAgICAgICAgICAgICAgICA/ICFEYXRlVGltZS5mcm9tSlNEYXRlKHZhbHVlKS5lcXVhbHMoRGF0ZVRpbWUuZnJvbUpTRGF0ZShkZXNjcmlwdG9yLnZhbHVlKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIDogdmFsdWUgIT09IGRlc2NyaXB0b3IudmFsdWU7XG4gICAgICAgICAgICAgICAgY2FzZSBcImd0XCI6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZSA9PSBudWxsIHx8IGRlc2NyaXB0b3IudmFsdWUgPT0gbnVsbCA/IGZhbHNlIDogdmFsdWUgPiBkZXNjcmlwdG9yLnZhbHVlO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJndGVcIjpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlID09IG51bGwgfHwgZGVzY3JpcHRvci52YWx1ZSA9PSBudWxsID8gZmFsc2UgOiB2YWx1ZSA+PSBkZXNjcmlwdG9yLnZhbHVlO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJsdFwiOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWUgPT0gbnVsbCB8fCBkZXNjcmlwdG9yLnZhbHVlID09IG51bGwgPyBmYWxzZSA6IHZhbHVlIDwgZGVzY3JpcHRvci52YWx1ZTtcbiAgICAgICAgICAgICAgICBjYXNlIFwibHRlXCI6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZSA9PSBudWxsIHx8IGRlc2NyaXB0b3IudmFsdWUgPT0gbnVsbCA/IGZhbHNlIDogdmFsdWUgPD0gZGVzY3JpcHRvci52YWx1ZTtcbiAgICAgICAgICAgICAgICBjYXNlIFwic3RhcnRzd2l0aFwiOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWUgPT0gbnVsbCB8fCBkZXNjcmlwdG9yLnZhbHVlID09IG51bGwgPyBmYWxzZSA6IHZhbHVlLnN0YXJ0c1dpdGgoZGVzY3JpcHRvci52YWx1ZSk7XG4gICAgICAgICAgICAgICAgY2FzZSBcImVuZHN3aXRoXCI6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZSA9PSBudWxsIHx8IGRlc2NyaXB0b3IudmFsdWUgPT0gbnVsbCA/IGZhbHNlIDogdmFsdWUuZW5kc1dpdGgoZGVzY3JpcHRvci52YWx1ZSk7XG4gICAgICAgICAgICAgICAgY2FzZSBcImNvbnRhaW5zXCI6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZSA9PSBudWxsIHx8IGRlc2NyaXB0b3IudmFsdWUgPT0gbnVsbCA/IGZhbHNlIDogdmFsdWUuaW5jbHVkZXMoZGVzY3JpcHRvci52YWx1ZSk7XG4gICAgICAgICAgICAgICAgY2FzZSBcImRvZXNub3Rjb250YWluXCI6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZSA9PSBudWxsIHx8IGRlc2NyaXB0b3IudmFsdWUgPT0gbnVsbCA/IGZhbHNlIDogIXZhbHVlLmluY2x1ZGVzKGRlc2NyaXB0b3IudmFsdWUpO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJpc251bGxcIjpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlID09IG51bGw7XG4gICAgICAgICAgICAgICAgY2FzZSBcImlzbm90bnVsbFwiOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWUgIT0gbnVsbDtcbiAgICAgICAgICAgICAgICBjYXNlIFwiaXNlbXB0eVwiOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWUgPT09IFwiXCI7XG4gICAgICAgICAgICAgICAgY2FzZSBcImlzbm90ZW1wdHlcIjpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlICE9PSBcIlwiO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJpc251bGxvcmVtcHR5XCI6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZSA9PSBudWxsIHx8IHZhbHVlID09PSBcIlwiO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJpc25vdG51bGxvcmVtcHR5XCI6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZSAhPSBudWxsICYmIHZhbHVlICE9PSBcIlwiO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJpblwiOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gKGRlc2NyaXB0b3IudmFsdWUgYXMgVFtdKS5pbmNsdWRlcyh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgY2FzZSBcIm5vdGluXCI6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAhKGRlc2NyaXB0b3IudmFsdWUgYXMgVFtdKS5pbmNsdWRlcyh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgY2FzZSBcImZ1bmN0aW9uXCI6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAoZGVzY3JpcHRvci5wcmVkaWNhdGUgYXMgUHJlZGljYXRlPFQ+KSh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH1cbn1cbiJdfQ==