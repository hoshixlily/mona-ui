import { ChangeDetectionStrategy, Component, Input } from "@angular/core";
import { fromEvent, mergeWith, Subject, takeUntil } from "rxjs";
import { faChevronDown, faChevronRight } from "@fortawesome/free-solid-svg-icons";
import { Dictionary, KeyValuePair } from "@mirei/ts-collections";
import * as i0 from "@angular/core";
import * as i1 from "../../services/grid.service";
import * as i2 from "@angular/common";
import * as i3 from "../../../buttons/modules/button/directives/button.directive";
import * as i4 from "@fortawesome/angular-fontawesome";
import * as i5 from "../grid-cell/grid-cell.component";
import * as i6 from "../../../pipes/slice.pipe";
import * as i7 from "../../pipes/grid-group.pipe";
export class GridListComponent {
    #destroy;
    constructor(gridService, elementRef) {
        this.gridService = gridService;
        this.elementRef = elementRef;
        this.#destroy = new Subject();
        this.collapseIcon = faChevronDown;
        this.expandIcon = faChevronRight;
        this.columns = [];
        this.data = [];
    }
    ngAfterViewInit() {
        window.setTimeout(() => {
            this.synchronizeHorizontalScroll();
        }, 0);
    }
    ngOnDestroy() {
        this.#destroy.next();
        this.#destroy.complete();
    }
    ngOnInit() {
        this.setSubscriptions();
    }
    onGridRowClick(event, row) {
        if (this.gridService.selectableOptions == null || !this.gridService.selectableOptions.enabled) {
            return;
        }
        if (this.gridService.selectableOptions.mode === "single") {
            if (row.selected && (event.ctrlKey || event.metaKey)) {
                this.gridService.selectedRows = [];
                row.selected = false;
            }
            else {
                if (this.gridService.selectedRows.length !== 0) {
                    this.gridService.selectedRows.forEach(r => (r.selected = false));
                }
                this.gridService.selectedRows = [row];
                row.selected = true;
            }
        }
        else if (this.gridService.selectableOptions.mode === "multiple") {
            if (this.gridService.selectedRows.length === 0) {
                this.gridService.selectedRows = [row];
                row.selected = true;
            }
            else {
                const index = this.gridService.selectedRows.findIndex(r => r === row);
                if (index === -1) {
                    this.gridService.selectedRows = [...this.gridService.selectedRows, row];
                    row.selected = true;
                }
                else {
                    if (event.ctrlKey || event.metaKey) {
                        this.gridService.selectedRows.splice(index, 1);
                        row.selected = false;
                    }
                }
            }
        }
        this.gridService.selectedRowsChange$.next(this.gridService.selectedRows);
    }
    onGroupExpandChange(group) {
        group.collapsed = !group.collapsed;
        const groupKey = `${group.column.field}-${group.rows[0].data[group.column.field]}`;
        const state = this.gridService.gridGroupExpandState.get(groupKey);
        if (state == null) {
            this.gridService.gridGroupExpandState.add(groupKey, new Dictionary(undefined, [
                new KeyValuePair(this.gridService.pageState.page, group.collapsed)
            ]));
        }
        else {
            if (state.containsKey(this.gridService.pageState.page)) {
                const value = state.get(this.gridService.pageState.page);
                if (value != null) {
                    state.remove(this.gridService.pageState.page);
                    state.add(this.gridService.pageState.page, !value);
                }
            }
            else {
                state.add(this.gridService.pageState.page, group.collapsed);
            }
        }
    }
    setSubscriptions() {
        fromEvent(document, "click")
            .pipe(mergeWith(fromEvent(document, "keyup")), takeUntil(this.#destroy))
            .subscribe(e => {
            if (e.type === "click") {
                const event = e;
                const target = event.target;
                if (target.closest(".mona-grid-cell") == null) {
                    this.gridService.isInEditMode = false;
                }
            }
            if (e.type === "keyup") {
                const event = e;
                if (event.key === "Escape") {
                    this.gridService.isInEditMode = false;
                }
            }
        });
    }
    synchronizeHorizontalScroll() {
        const headerElement = this.gridService.gridHeaderElement;
        const gridElement = this.elementRef.nativeElement.querySelector(".mona-grid-list");
        if (headerElement == null || gridElement == null) {
            return;
        }
        fromEvent(gridElement, "scroll")
            .pipe(takeUntil(this.#destroy))
            .subscribe(() => {
            headerElement.scrollLeft = gridElement.scrollLeft;
        });
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.0.0", ngImport: i0, type: GridListComponent, deps: [{ token: i1.GridService }, { token: i0.ElementRef }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "16.0.0", type: GridListComponent, selector: "mona-grid-list", inputs: { columns: "columns", data: "data" }, ngImport: i0, template: "<div class=\"mona-grid-list\">\n    <div class=\"mona-grid-list-wrap\">\n        <table>\n            <colgroup>\n                <col *ngFor=\"let _ of gridService.groupColumns\" style=\"width: 34px;\">\n                <col *ngFor=\"let column of gridService.columns\"\n                     [style.width.px]=\"column.calculatedWidth\" [style.min-width.px]=\"column.minWidth\">\n            </colgroup>\n            <tbody>\n                <ng-container *ngIf=\"gridService.groupColumns.length === 0\">\n                    <tr *ngFor=\"let row of data; let rx=index;\" (click)=\"onGridRowClick($event, row)\" [ngClass]=\"{'mona-selected': row.selected}\"\n                        [attr.data-ruid]=\"row.uid\" [attr.data-row-view-index]=\"rx\">\n                        <td *ngFor=\"let column of columns\">\n                            <mona-grid-cell [column]=\"column\" [row]=\"row\"></mona-grid-cell>\n                        </td>\n                    </tr>\n                </ng-container>\n                <ng-container *ngIf=\"gridService.groupColumns.length !== 0\">\n                    <ng-template #gridGroupTemplate let-groupData let-column=\"column\" let-cx=\"cx\" let-depth=\"depth\">\n                        <ng-container *ngIf=\"groupData|gridGroup:column:gridService.pageState.page as groupItem\">\n                            <ng-container *ngFor=\"let subGroup of groupItem\">\n                                <tr class=\"mona-grid-grouping-row\">\n                                    <td *ngFor=\"let _ of gridService.groupColumns|monaSlice:0:cx\"></td>\n                                    <td [colSpan]=\"columns.length + gridService.groupColumns.length\"\n                                        *ngIf=\"subGroup.rows.length > 0\">\n                                        <button monaButton [flat]=\"true\" style=\"width: 34px;\" (click)=\"onGroupExpandChange(subGroup)\">\n                                            <fa-icon [icon]=\"collapseIcon\" *ngIf=\"!subGroup.collapsed\"></fa-icon>\n                                            <fa-icon [icon]=\"expandIcon\" *ngIf=\"subGroup.collapsed\"></fa-icon>\n                                        </button>\n                                        <span class=\"mona-grid-grouping-row-text\">{{column.title}}: {{subGroup.rows[0].data[column.field]}}</span>\n                                    </td>\n                                </tr>\n\n                                <ng-container *ngIf=\"cx < gridService.groupColumns.length-1 && !subGroup.collapsed\">\n                                    <ng-container [ngTemplateOutlet]=\"gridGroupTemplate\"\n                                                  [ngTemplateOutletContext]=\"{$implicit: subGroup.rows, column: gridService.groupColumns[cx+1], cx: cx+1, depth:depth+1}\">\n                                    </ng-container>\n                                </ng-container>\n                                <ng-container *ngIf=\"depth===gridService.groupColumns.length-1 && !subGroup.collapsed\">\n                                    <tr *ngFor=\"let row of subGroup.rows; let rx=index;\" (click)=\"onGridRowClick($event, row)\" [ngClass]=\"{'mona-selected': row.selected}\"\n                                        [attr.data-ruid]=\"row.uid\" [attr.data-row-view-index]=\"rx\">\n                                        <td *ngFor=\"let _ of gridService.groupColumns\"></td>\n                                        <td *ngFor=\"let column of columns\">\n                                            <mona-grid-cell [column]=\"column\" [row]=\"row\"></mona-grid-cell>\n                                        </td>\n                                    </tr>\n                                </ng-container>\n                            </ng-container>\n                        </ng-container>\n                    </ng-template>\n\n                    <ng-container [ngTemplateOutlet]=\"gridGroupTemplate\"\n                                  [ngTemplateOutletContext]=\"{$implicit: data, column: gridService.groupColumns[0], cx: 0, depth: 0}\"></ng-container>\n                </ng-container>\n            </tbody>\n        </table>\n    </div>\n</div>\n", styles: [":host{overflow:hidden;height:100%;display:flex}div.mona-grid-list{overflow:auto scroll;width:100%}table{border-collapse:collapse;width:100%;height:100%;table-layout:fixed}table tbody{text-align:left}table tr:nth-child(even){background-color:var(--mona-background-dark)}table tr:nth-child(odd){background-color:var(--mona-background)}table tr:not(:last-child){border-bottom:1px solid var(--mona-border-color)}table td{position:relative}table td:not(:last-child){border-right:1px solid var(--mona-border-color)}tr.mona-grid-grouping-row>td:last-child{font-weight:bolder;padding:0}span.mona-grid-grouping-row-text{font-weight:bolder;margin-left:8px}\n"], dependencies: [{ kind: "directive", type: i2.NgClass, selector: "[ngClass]", inputs: ["class", "ngClass"] }, { kind: "directive", type: i2.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i2.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "directive", type: i2.NgTemplateOutlet, selector: "[ngTemplateOutlet]", inputs: ["ngTemplateOutletContext", "ngTemplateOutlet", "ngTemplateOutletInjector"] }, { kind: "directive", type: i3.ButtonDirective, selector: "[monaButton]", inputs: ["disabled", "flat", "primary", "selected", "toggleable"], outputs: ["selectedChange"] }, { kind: "component", type: i4.FaIconComponent, selector: "fa-icon", inputs: ["icon", "title", "spin", "pulse", "mask", "styles", "flip", "size", "pull", "border", "inverse", "symbol", "rotate", "fixedWidth", "classes", "transform", "a11yRole"] }, { kind: "component", type: i5.GridCellComponent, selector: "mona-grid-cell", inputs: ["column", "row"] }, { kind: "pipe", type: i6.SlicePipe, name: "monaSlice" }, { kind: "pipe", type: i7.GridGroupPipe, name: "gridGroup" }], changeDetection: i0.ChangeDetectionStrategy.Default }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.0.0", ngImport: i0, type: GridListComponent, decorators: [{
            type: Component,
            args: [{ selector: "mona-grid-list", changeDetection: ChangeDetectionStrategy.Default, template: "<div class=\"mona-grid-list\">\n    <div class=\"mona-grid-list-wrap\">\n        <table>\n            <colgroup>\n                <col *ngFor=\"let _ of gridService.groupColumns\" style=\"width: 34px;\">\n                <col *ngFor=\"let column of gridService.columns\"\n                     [style.width.px]=\"column.calculatedWidth\" [style.min-width.px]=\"column.minWidth\">\n            </colgroup>\n            <tbody>\n                <ng-container *ngIf=\"gridService.groupColumns.length === 0\">\n                    <tr *ngFor=\"let row of data; let rx=index;\" (click)=\"onGridRowClick($event, row)\" [ngClass]=\"{'mona-selected': row.selected}\"\n                        [attr.data-ruid]=\"row.uid\" [attr.data-row-view-index]=\"rx\">\n                        <td *ngFor=\"let column of columns\">\n                            <mona-grid-cell [column]=\"column\" [row]=\"row\"></mona-grid-cell>\n                        </td>\n                    </tr>\n                </ng-container>\n                <ng-container *ngIf=\"gridService.groupColumns.length !== 0\">\n                    <ng-template #gridGroupTemplate let-groupData let-column=\"column\" let-cx=\"cx\" let-depth=\"depth\">\n                        <ng-container *ngIf=\"groupData|gridGroup:column:gridService.pageState.page as groupItem\">\n                            <ng-container *ngFor=\"let subGroup of groupItem\">\n                                <tr class=\"mona-grid-grouping-row\">\n                                    <td *ngFor=\"let _ of gridService.groupColumns|monaSlice:0:cx\"></td>\n                                    <td [colSpan]=\"columns.length + gridService.groupColumns.length\"\n                                        *ngIf=\"subGroup.rows.length > 0\">\n                                        <button monaButton [flat]=\"true\" style=\"width: 34px;\" (click)=\"onGroupExpandChange(subGroup)\">\n                                            <fa-icon [icon]=\"collapseIcon\" *ngIf=\"!subGroup.collapsed\"></fa-icon>\n                                            <fa-icon [icon]=\"expandIcon\" *ngIf=\"subGroup.collapsed\"></fa-icon>\n                                        </button>\n                                        <span class=\"mona-grid-grouping-row-text\">{{column.title}}: {{subGroup.rows[0].data[column.field]}}</span>\n                                    </td>\n                                </tr>\n\n                                <ng-container *ngIf=\"cx < gridService.groupColumns.length-1 && !subGroup.collapsed\">\n                                    <ng-container [ngTemplateOutlet]=\"gridGroupTemplate\"\n                                                  [ngTemplateOutletContext]=\"{$implicit: subGroup.rows, column: gridService.groupColumns[cx+1], cx: cx+1, depth:depth+1}\">\n                                    </ng-container>\n                                </ng-container>\n                                <ng-container *ngIf=\"depth===gridService.groupColumns.length-1 && !subGroup.collapsed\">\n                                    <tr *ngFor=\"let row of subGroup.rows; let rx=index;\" (click)=\"onGridRowClick($event, row)\" [ngClass]=\"{'mona-selected': row.selected}\"\n                                        [attr.data-ruid]=\"row.uid\" [attr.data-row-view-index]=\"rx\">\n                                        <td *ngFor=\"let _ of gridService.groupColumns\"></td>\n                                        <td *ngFor=\"let column of columns\">\n                                            <mona-grid-cell [column]=\"column\" [row]=\"row\"></mona-grid-cell>\n                                        </td>\n                                    </tr>\n                                </ng-container>\n                            </ng-container>\n                        </ng-container>\n                    </ng-template>\n\n                    <ng-container [ngTemplateOutlet]=\"gridGroupTemplate\"\n                                  [ngTemplateOutletContext]=\"{$implicit: data, column: gridService.groupColumns[0], cx: 0, depth: 0}\"></ng-container>\n                </ng-container>\n            </tbody>\n        </table>\n    </div>\n</div>\n", styles: [":host{overflow:hidden;height:100%;display:flex}div.mona-grid-list{overflow:auto scroll;width:100%}table{border-collapse:collapse;width:100%;height:100%;table-layout:fixed}table tbody{text-align:left}table tr:nth-child(even){background-color:var(--mona-background-dark)}table tr:nth-child(odd){background-color:var(--mona-background)}table tr:not(:last-child){border-bottom:1px solid var(--mona-border-color)}table td{position:relative}table td:not(:last-child){border-right:1px solid var(--mona-border-color)}tr.mona-grid-grouping-row>td:last-child{font-weight:bolder;padding:0}span.mona-grid-grouping-row-text{font-weight:bolder;margin-left:8px}\n"] }]
        }], ctorParameters: function () { return [{ type: i1.GridService }, { type: i0.ElementRef }]; }, propDecorators: { columns: [{
                type: Input
            }], data: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ3JpZC1saXN0LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL21vbmEtdWkvc3JjL2xpYi9ncmlkL2NvbXBvbmVudHMvZ3JpZC1saXN0L2dyaWQtbGlzdC5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9tb25hLXVpL3NyYy9saWIvZ3JpZC9jb21wb25lbnRzL2dyaWQtbGlzdC9ncmlkLWxpc3QuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFpQix1QkFBdUIsRUFBRSxTQUFTLEVBQWMsS0FBSyxFQUFxQixNQUFNLGVBQWUsQ0FBQztBQUV4SCxPQUFPLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBR2hFLE9BQU8sRUFBRSxhQUFhLEVBQUUsY0FBYyxFQUFrQixNQUFNLG1DQUFtQyxDQUFDO0FBRWxHLE9BQU8sRUFBRSxVQUFVLEVBQUUsWUFBWSxFQUFFLE1BQU0sdUJBQXVCLENBQUM7Ozs7Ozs7OztBQVFqRSxNQUFNLE9BQU8saUJBQWlCO0lBQ2pCLFFBQVEsQ0FBc0M7SUFVdkQsWUFDb0IsV0FBd0IsRUFDdkIsVUFBc0M7UUFEdkMsZ0JBQVcsR0FBWCxXQUFXLENBQWE7UUFDdkIsZUFBVSxHQUFWLFVBQVUsQ0FBNEI7UUFabEQsYUFBUSxHQUFrQixJQUFJLE9BQU8sRUFBUSxDQUFDO1FBQ3ZDLGlCQUFZLEdBQW1CLGFBQWEsQ0FBQztRQUM3QyxlQUFVLEdBQW1CLGNBQWMsQ0FBQztRQUdyRCxZQUFPLEdBQWEsRUFBRSxDQUFDO1FBR3ZCLFNBQUksR0FBVSxFQUFFLENBQUM7SUFLckIsQ0FBQztJQUVHLGVBQWU7UUFDbEIsTUFBTSxDQUFDLFVBQVUsQ0FBQyxHQUFHLEVBQUU7WUFDbkIsSUFBSSxDQUFDLDJCQUEyQixFQUFFLENBQUM7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WUFDWixhQUFhLENBQUMsVUFBVSxHQUFHLFdBQVcsQ0FBQyxVQUFVLENBQUM7UUFDdEQsQ0FBQyxDQUFDLENBQUM7SUFDWCxDQUFDOzhHQXpIUSxpQkFBaUI7a0dBQWpCLGlCQUFpQixvR0NmOUIsK2xJQTBEQTs7MkZEM0NhLGlCQUFpQjtrQkFON0IsU0FBUzsrQkFDSSxnQkFBZ0IsbUJBR1QsdUJBQXVCLENBQUMsT0FBTzsySEFRekMsT0FBTztzQkFEYixLQUFLO2dCQUlDLElBQUk7c0JBRFYsS0FBSyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFmdGVyVmlld0luaXQsIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LCBDb21wb25lbnQsIEVsZW1lbnRSZWYsIElucHV0LCBPbkRlc3Ryb3ksIE9uSW5pdCB9IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XG5pbXBvcnQgeyBHcmlkU2VydmljZSB9IGZyb20gXCIuLi8uLi9zZXJ2aWNlcy9ncmlkLnNlcnZpY2VcIjtcbmltcG9ydCB7IGZyb21FdmVudCwgbWVyZ2VXaXRoLCBTdWJqZWN0LCB0YWtlVW50aWwgfSBmcm9tIFwicnhqc1wiO1xuaW1wb3J0IHsgQ29sdW1uIH0gZnJvbSBcIi4uLy4uL21vZGVscy9Db2x1bW5cIjtcbmltcG9ydCB7IFJvdyB9IGZyb20gXCIuLi8uLi9tb2RlbHMvUm93XCI7XG5pbXBvcnQgeyBmYUNoZXZyb25Eb3duLCBmYUNoZXZyb25SaWdodCwgSWNvbkRlZmluaXRpb24gfSBmcm9tIFwiQGZvcnRhd2Vzb21lL2ZyZWUtc29saWQtc3ZnLWljb25zXCI7XG5pbXBvcnQgeyBHcmlkR3JvdXAgfSBmcm9tIFwiLi4vLi4vbW9kZWxzL0dyaWRHcm91cFwiO1xuaW1wb3J0IHsgRGljdGlvbmFyeSwgS2V5VmFsdWVQYWlyIH0gZnJvbSBcIkBtaXJlaS90cy1jb2xsZWN0aW9uc1wiO1xuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogXCJtb25hLWdyaWQtbGlzdFwiLFxuICAgIHRlbXBsYXRlVXJsOiBcIi4vZ3JpZC1saXN0LmNvbXBvbmVudC5odG1sXCIsXG4gICAgc3R5bGVVcmxzOiBbXCIuL2dyaWQtbGlzdC5jb21wb25lbnQuc2Nzc1wiXSxcbiAgICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5LkRlZmF1bHRcbn0pXG5leHBvcnQgY2xhc3MgR3JpZExpc3RDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIEFmdGVyVmlld0luaXQsIE9uRGVzdHJveSB7XG4gICAgcmVhZG9ubHkgI2Rlc3Ryb3k6IFN1YmplY3Q8dm9pZD4gPSBuZXcgU3ViamVjdDx2b2lkPigpO1xuICAgIHB1YmxpYyByZWFkb25seSBjb2xsYXBzZUljb246IEljb25EZWZpbml0aW9uID0gZmFDaGV2cm9uRG93bjtcbiAgICBwdWJsaWMgcmVhZG9ubHkgZXhwYW5kSWNvbjogSWNvbkRlZmluaXRpb24gPSBmYUNoZXZyb25SaWdodDtcblxuICAgIEBJbnB1dCgpXG4gICAgcHVibGljIGNvbHVtbnM6IENvbHVtbltdID0gW107XG5cbiAgICBASW5wdXQoKVxuICAgIHB1YmxpYyBkYXRhOiBSb3dbXSA9IFtdO1xuXG4gICAgcHVibGljIGNvbnN0cnVjdG9yKFxuICAgICAgICBwdWJsaWMgcmVhZG9ubHkgZ3JpZFNlcnZpY2U6IEdyaWRTZXJ2aWNlLFxuICAgICAgICBwcml2YXRlIHJlYWRvbmx5IGVsZW1lbnRSZWY6IEVsZW1lbnRSZWY8SFRNTERpdkVsZW1lbnQ+XG4gICAgKSB7fVxuXG4gICAgcHVibGljIG5nQWZ0ZXJWaWV3SW5pdCgpOiB2b2lkIHtcbiAgICAgICAgd2luZG93LnNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5zeW5jaHJvbml6ZUhvcml6b250YWxTY3JvbGwoKTtcbiAgICAgICAgfSwgMCk7XG4gICAgfVxuXG4gICAgcHVibGljIG5nT25EZXN0cm95KCk6IHZvaWQge1xuICAgICAgICB0aGlzLiNkZXN0cm95Lm5leHQoKTtcbiAgICAgICAgdGhpcy4jZGVzdHJveS5jb21wbGV0ZSgpO1xuICAgIH1cblxuICAgIHB1YmxpYyBuZ09uSW5pdCgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5zZXRTdWJzY3JpcHRpb25zKCk7XG4gICAgfVxuXG4gICAgcHVibGljIG9uR3JpZFJvd0NsaWNrKGV2ZW50OiBNb3VzZUV2ZW50LCByb3c6IFJvdyk6IHZvaWQge1xuICAgICAgICBpZiAodGhpcy5ncmlkU2VydmljZS5zZWxlY3RhYmxlT3B0aW9ucyA9PSBudWxsIHx8ICF0aGlzLmdyaWRTZXJ2aWNlLnNlbGVjdGFibGVPcHRpb25zLmVuYWJsZWQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5ncmlkU2VydmljZS5zZWxlY3RhYmxlT3B0aW9ucy5tb2RlID09PSBcInNpbmdsZVwiKSB7XG4gICAgICAgICAgICBpZiAocm93LnNlbGVjdGVkICYmIChldmVudC5jdHJsS2V5IHx8IGV2ZW50Lm1ldGFLZXkpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncmlkU2VydmljZS5zZWxlY3RlZFJvd3MgPSBbXTtcbiAgICAgICAgICAgICAgICByb3cuc2VsZWN0ZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZ3JpZFNlcnZpY2Uuc2VsZWN0ZWRSb3dzLmxlbmd0aCAhPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmdyaWRTZXJ2aWNlLnNlbGVjdGVkUm93cy5mb3JFYWNoKHIgPT4gKHIuc2VsZWN0ZWQgPSBmYWxzZSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLmdyaWRTZXJ2aWNlLnNlbGVjdGVkUm93cyA9IFtyb3ddO1xuICAgICAgICAgICAgICAgIHJvdy5zZWxlY3RlZCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5ncmlkU2VydmljZS5zZWxlY3RhYmxlT3B0aW9ucy5tb2RlID09PSBcIm11bHRpcGxlXCIpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmdyaWRTZXJ2aWNlLnNlbGVjdGVkUm93cy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdyaWRTZXJ2aWNlLnNlbGVjdGVkUm93cyA9IFtyb3ddO1xuICAgICAgICAgICAgICAgIHJvdy5zZWxlY3RlZCA9IHRydWU7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5ncmlkU2VydmljZS5zZWxlY3RlZFJvd3MuZmluZEluZGV4KHIgPT4gciA9PT0gcm93KTtcbiAgICAgICAgICAgICAgICBpZiAoaW5kZXggPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZ3JpZFNlcnZpY2Uuc2VsZWN0ZWRSb3dzID0gWy4uLnRoaXMuZ3JpZFNlcnZpY2Uuc2VsZWN0ZWRSb3dzLCByb3ddO1xuICAgICAgICAgICAgICAgICAgICByb3cuc2VsZWN0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChldmVudC5jdHJsS2V5IHx8IGV2ZW50Lm1ldGFLZXkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZ3JpZFNlcnZpY2Uuc2VsZWN0ZWRSb3dzLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgICAgICAgICAgICAgICAgICByb3cuc2VsZWN0ZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLmdyaWRTZXJ2aWNlLnNlbGVjdGVkUm93c0NoYW5nZSQubmV4dCh0aGlzLmdyaWRTZXJ2aWNlLnNlbGVjdGVkUm93cyk7XG4gICAgfVxuXG4gICAgcHVibGljIG9uR3JvdXBFeHBhbmRDaGFuZ2UoZ3JvdXA6IEdyaWRHcm91cCk6IHZvaWQge1xuICAgICAgICBncm91cC5jb2xsYXBzZWQgPSAhZ3JvdXAuY29sbGFwc2VkO1xuICAgICAgICBjb25zdCBncm91cEtleSA9IGAke2dyb3VwLmNvbHVtbi5maWVsZH0tJHtncm91cC5yb3dzWzBdLmRhdGFbZ3JvdXAuY29sdW1uLmZpZWxkXX1gO1xuICAgICAgICBjb25zdCBzdGF0ZSA9IHRoaXMuZ3JpZFNlcnZpY2UuZ3JpZEdyb3VwRXhwYW5kU3RhdGUuZ2V0KGdyb3VwS2V5KTtcbiAgICAgICAgaWYgKHN0YXRlID09IG51bGwpIHtcbiAgICAgICAgICAgIHRoaXMuZ3JpZFNlcnZpY2UuZ3JpZEdyb3VwRXhwYW5kU3RhdGUuYWRkKFxuICAgICAgICAgICAgICAgIGdyb3VwS2V5LFxuICAgICAgICAgICAgICAgIG5ldyBEaWN0aW9uYXJ5PG51bWJlciwgYm9vbGVhbj4odW5kZWZpbmVkLCBbXG4gICAgICAgICAgICAgICAgICAgIG5ldyBLZXlWYWx1ZVBhaXI8bnVtYmVyLCBib29sZWFuPih0aGlzLmdyaWRTZXJ2aWNlLnBhZ2VTdGF0ZS5wYWdlLCBncm91cC5jb2xsYXBzZWQpXG4gICAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgICk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAoc3RhdGUuY29udGFpbnNLZXkodGhpcy5ncmlkU2VydmljZS5wYWdlU3RhdGUucGFnZSkpIHtcbiAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IHN0YXRlLmdldCh0aGlzLmdyaWRTZXJ2aWNlLnBhZ2VTdGF0ZS5wYWdlKTtcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICBzdGF0ZS5yZW1vdmUodGhpcy5ncmlkU2VydmljZS5wYWdlU3RhdGUucGFnZSk7XG4gICAgICAgICAgICAgICAgICAgIHN0YXRlLmFkZCh0aGlzLmdyaWRTZXJ2aWNlLnBhZ2VTdGF0ZS5wYWdlLCAhdmFsdWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgc3RhdGUuYWRkKHRoaXMuZ3JpZFNlcnZpY2UucGFnZVN0YXRlLnBhZ2UsIGdyb3VwLmNvbGxhcHNlZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIHNldFN1YnNjcmlwdGlvbnMoKTogdm9pZCB7XG4gICAgICAgIGZyb21FdmVudDxNb3VzZUV2ZW50Pihkb2N1bWVudCwgXCJjbGlja1wiKVxuICAgICAgICAgICAgLnBpcGUobWVyZ2VXaXRoKGZyb21FdmVudDxLZXlib2FyZEV2ZW50Pihkb2N1bWVudCwgXCJrZXl1cFwiKSksIHRha2VVbnRpbCh0aGlzLiNkZXN0cm95KSlcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoZSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGUudHlwZSA9PT0gXCJjbGlja1wiKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGV2ZW50ID0gZSBhcyBNb3VzZUV2ZW50O1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB0YXJnZXQgPSBldmVudC50YXJnZXQgYXMgSFRNTEVsZW1lbnQ7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0YXJnZXQuY2xvc2VzdChcIi5tb25hLWdyaWQtY2VsbFwiKSA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdyaWRTZXJ2aWNlLmlzSW5FZGl0TW9kZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChlLnR5cGUgPT09IFwia2V5dXBcIikge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBldmVudCA9IGUgYXMgS2V5Ym9hcmRFdmVudDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50LmtleSA9PT0gXCJFc2NhcGVcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5ncmlkU2VydmljZS5pc0luRWRpdE1vZGUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgIH1cblxuICAgIHByaXZhdGUgc3luY2hyb25pemVIb3Jpem9udGFsU2Nyb2xsKCk6IHZvaWQge1xuICAgICAgICBjb25zdCBoZWFkZXJFbGVtZW50ID0gdGhpcy5ncmlkU2VydmljZS5ncmlkSGVhZGVyRWxlbWVudDtcbiAgICAgICAgY29uc3QgZ3JpZEVsZW1lbnQgPSB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vbmEtZ3JpZC1saXN0XCIpIGFzIEhUTUxEaXZFbGVtZW50O1xuICAgICAgICBpZiAoaGVhZGVyRWxlbWVudCA9PSBudWxsIHx8IGdyaWRFbGVtZW50ID09IG51bGwpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBmcm9tRXZlbnQoZ3JpZEVsZW1lbnQsIFwic2Nyb2xsXCIpXG4gICAgICAgICAgICAucGlwZSh0YWtlVW50aWwodGhpcy4jZGVzdHJveSkpXG4gICAgICAgICAgICAuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgICAgICAgICAgICBoZWFkZXJFbGVtZW50LnNjcm9sbExlZnQgPSBncmlkRWxlbWVudC5zY3JvbGxMZWZ0O1xuICAgICAgICAgICAgfSk7XG4gICAgfVxufVxuIiwiPGRpdiBjbGFzcz1cIm1vbmEtZ3JpZC1saXN0XCI+XG4gICAgPGRpdiBjbGFzcz1cIm1vbmEtZ3JpZC1saXN0LXdyYXBcIj5cbiAgICAgICAgPHRhYmxlPlxuICAgICAgICAgICAgPGNvbGdyb3VwPlxuICAgICAgICAgICAgICAgIDxjb2wgKm5nRm9yPVwibGV0IF8gb2YgZ3JpZFNlcnZpY2UuZ3JvdXBDb2x1bW5zXCIgc3R5bGU9XCJ3aWR0aDogMzRweDtcIj5cbiAgICAgICAgICAgICAgICA8Y29sICpuZ0Zvcj1cImxldCBjb2x1bW4gb2YgZ3JpZFNlcnZpY2UuY29sdW1uc1wiXG4gICAgICAgICAgICAgICAgICAgICBbc3R5bGUud2lkdGgucHhdPVwiY29sdW1uLmNhbGN1bGF0ZWRXaWR0aFwiIFtzdHlsZS5taW4td2lkdGgucHhdPVwiY29sdW1uLm1pbldpZHRoXCI+XG4gICAgICAgICAgICA8L2NvbGdyb3VwPlxuICAgICAgICAgICAgPHRib2R5PlxuICAgICAgICAgICAgICAgIDxuZy1jb250YWluZXIgKm5nSWY9XCJncmlkU2VydmljZS5ncm91cENvbHVtbnMubGVuZ3RoID09PSAwXCI+XG4gICAgICAgICAgICAgICAgICAgIDx0ciAqbmdGb3I9XCJsZXQgcm93IG9mIGRhdGE7IGxldCByeD1pbmRleDtcIiAoY2xpY2spPVwib25HcmlkUm93Q2xpY2soJGV2ZW50LCByb3cpXCIgW25nQ2xhc3NdPVwieydtb25hLXNlbGVjdGVkJzogcm93LnNlbGVjdGVkfVwiXG4gICAgICAgICAgICAgICAgICAgICAgICBbYXR0ci5kYXRhLXJ1aWRdPVwicm93LnVpZFwiIFthdHRyLmRhdGEtcm93LXZpZXctaW5kZXhdPVwicnhcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDx0ZCAqbmdGb3I9XCJsZXQgY29sdW1uIG9mIGNvbHVtbnNcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bW9uYS1ncmlkLWNlbGwgW2NvbHVtbl09XCJjb2x1bW5cIiBbcm93XT1cInJvd1wiPjwvbW9uYS1ncmlkLWNlbGw+XG4gICAgICAgICAgICAgICAgICAgICAgICA8L3RkPlxuICAgICAgICAgICAgICAgICAgICA8L3RyPlxuICAgICAgICAgICAgICAgIDwvbmctY29udGFpbmVyPlxuICAgICAgICAgICAgICAgIDxuZy1jb250YWluZXIgKm5nSWY9XCJncmlkU2VydmljZS5ncm91cENvbHVtbnMubGVuZ3RoICE9PSAwXCI+XG4gICAgICAgICAgICAgICAgICAgIDxuZy10ZW1wbGF0ZSAjZ3JpZEdyb3VwVGVtcGxhdGUgbGV0LWdyb3VwRGF0YSBsZXQtY29sdW1uPVwiY29sdW1uXCIgbGV0LWN4PVwiY3hcIiBsZXQtZGVwdGg9XCJkZXB0aFwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgPG5nLWNvbnRhaW5lciAqbmdJZj1cImdyb3VwRGF0YXxncmlkR3JvdXA6Y29sdW1uOmdyaWRTZXJ2aWNlLnBhZ2VTdGF0ZS5wYWdlIGFzIGdyb3VwSXRlbVwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxuZy1jb250YWluZXIgKm5nRm9yPVwibGV0IHN1Ykdyb3VwIG9mIGdyb3VwSXRlbVwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dHIgY2xhc3M9XCJtb25hLWdyaWQtZ3JvdXBpbmctcm93XCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQgKm5nRm9yPVwibGV0IF8gb2YgZ3JpZFNlcnZpY2UuZ3JvdXBDb2x1bW5zfG1vbmFTbGljZTowOmN4XCI+PC90ZD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ZCBbY29sU3Bhbl09XCJjb2x1bW5zLmxlbmd0aCArIGdyaWRTZXJ2aWNlLmdyb3VwQ29sdW1ucy5sZW5ndGhcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICpuZ0lmPVwic3ViR3JvdXAucm93cy5sZW5ndGggPiAwXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBtb25hQnV0dG9uIFtmbGF0XT1cInRydWVcIiBzdHlsZT1cIndpZHRoOiAzNHB4O1wiIChjbGljayk9XCJvbkdyb3VwRXhwYW5kQ2hhbmdlKHN1Ykdyb3VwKVwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZmEtaWNvbiBbaWNvbl09XCJjb2xsYXBzZUljb25cIiAqbmdJZj1cIiFzdWJHcm91cC5jb2xsYXBzZWRcIj48L2ZhLWljb24+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxmYS1pY29uIFtpY29uXT1cImV4cGFuZEljb25cIiAqbmdJZj1cInN1Ykdyb3VwLmNvbGxhcHNlZFwiPjwvZmEtaWNvbj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cIm1vbmEtZ3JpZC1ncm91cGluZy1yb3ctdGV4dFwiPnt7Y29sdW1uLnRpdGxlfX06IHt7c3ViR3JvdXAucm93c1swXS5kYXRhW2NvbHVtbi5maWVsZF19fTwvc3Bhbj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdGQ+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdHI+XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPG5nLWNvbnRhaW5lciAqbmdJZj1cImN4IDwgZ3JpZFNlcnZpY2UuZ3JvdXBDb2x1bW5zLmxlbmd0aC0xICYmICFzdWJHcm91cC5jb2xsYXBzZWRcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxuZy1jb250YWluZXIgW25nVGVtcGxhdGVPdXRsZXRdPVwiZ3JpZEdyb3VwVGVtcGxhdGVcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbbmdUZW1wbGF0ZU91dGxldENvbnRleHRdPVwieyRpbXBsaWNpdDogc3ViR3JvdXAucm93cywgY29sdW1uOiBncmlkU2VydmljZS5ncm91cENvbHVtbnNbY3grMV0sIGN4OiBjeCsxLCBkZXB0aDpkZXB0aCsxfVwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9uZy1jb250YWluZXI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvbmctY29udGFpbmVyPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bmctY29udGFpbmVyICpuZ0lmPVwiZGVwdGg9PT1ncmlkU2VydmljZS5ncm91cENvbHVtbnMubGVuZ3RoLTEgJiYgIXN1Ykdyb3VwLmNvbGxhcHNlZFwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRyICpuZ0Zvcj1cImxldCByb3cgb2Ygc3ViR3JvdXAucm93czsgbGV0IHJ4PWluZGV4O1wiIChjbGljayk9XCJvbkdyaWRSb3dDbGljaygkZXZlbnQsIHJvdylcIiBbbmdDbGFzc109XCJ7J21vbmEtc2VsZWN0ZWQnOiByb3cuc2VsZWN0ZWR9XCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbYXR0ci5kYXRhLXJ1aWRdPVwicm93LnVpZFwiIFthdHRyLmRhdGEtcm93LXZpZXctaW5kZXhdPVwicnhcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQgKm5nRm9yPVwibGV0IF8gb2YgZ3JpZFNlcnZpY2UuZ3JvdXBDb2x1bW5zXCI+PC90ZD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQgKm5nRm9yPVwibGV0IGNvbHVtbiBvZiBjb2x1bW5zXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxtb25hLWdyaWQtY2VsbCBbY29sdW1uXT1cImNvbHVtblwiIFtyb3ddPVwicm93XCI+PC9tb25hLWdyaWQtY2VsbD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3RkPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC90cj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9uZy1jb250YWluZXI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9uZy1jb250YWluZXI+XG4gICAgICAgICAgICAgICAgICAgICAgICA8L25nLWNvbnRhaW5lcj5cbiAgICAgICAgICAgICAgICAgICAgPC9uZy10ZW1wbGF0ZT5cblxuICAgICAgICAgICAgICAgICAgICA8bmctY29udGFpbmVyIFtuZ1RlbXBsYXRlT3V0bGV0XT1cImdyaWRHcm91cFRlbXBsYXRlXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbbmdUZW1wbGF0ZU91dGxldENvbnRleHRdPVwieyRpbXBsaWNpdDogZGF0YSwgY29sdW1uOiBncmlkU2VydmljZS5ncm91cENvbHVtbnNbMF0sIGN4OiAwLCBkZXB0aDogMH1cIj48L25nLWNvbnRhaW5lcj5cbiAgICAgICAgICAgICAgICA8L25nLWNvbnRhaW5lcj5cbiAgICAgICAgICAgIDwvdGJvZHk+XG4gICAgICAgIDwvdGFibGU+XG4gICAgPC9kaXY+XG48L2Rpdj5cbiJdfQ==