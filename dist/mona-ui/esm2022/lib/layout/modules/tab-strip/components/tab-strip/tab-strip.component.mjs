import { Component, ContentChildren, EventEmitter, Input, Output, QueryList } from "@angular/core";
import { TabComponent } from "../tab/tab.component";
import { interval, Subject, takeUntil, timer } from "rxjs";
import { faChevronLeft, faChevronRight, faXmark } from "@fortawesome/free-solid-svg-icons";
import { TabCloseEvent } from "../../data/TabCloseEvent";
import * as i0 from "@angular/core";
import * as i1 from "@angular/common";
import * as i2 from "@fortawesome/angular-fontawesome";
import * as i3 from "../../../../../buttons/modules/button/directives/button.directive";
export class TabStripComponent {
    constructor(cdr) {
        this.cdr = cdr;
        this.componentDestroy$ = new Subject();
        this.scroll$ = new Subject();
        this.scrollLeftIcon = faChevronLeft;
        this.scrollRightIcon = faChevronRight;
        this.tabCloseIcon = faXmark;
        // public selectedTab?: TabComponent;
        this.closable = false;
        this.keepTabContent = false;
        this.tabClose = new EventEmitter();
        this.tabComponents = new QueryList();
    }
    ngAfterContentInit() {
        this.tabComponents.forEach((t, tx) => (t.index = tx));
        this.tabComponents.changes
            .pipe(takeUntil(this.componentDestroy$))
            .subscribe((tabs) => {
            tabs.forEach((t, tx) => (t.index = tx));
        });
    }
    ngAfterViewInit() {
        // this.selectedTab = this.tabComponents.find(t => t.selected)
        // if (this.selectedTab) {
        //     this.selectedTab.active = true;
        // }
        this.cdr.detectChanges();
    }
    ngOnDestroy() {
        this.componentDestroy$.next();
        this.componentDestroy$.complete();
    }
    ngOnInit() { }
    onTabClick(tab, tabListElement) {
        this.tabComponents.forEach(t => (t.selected = false));
        tab.selected = true;
        window.setTimeout(() => {
            const listElement = tabListElement.querySelector("li.mona-tab-active");
            if (listElement) {
                listElement.scrollIntoView({ behavior: "smooth", block: "center" });
            }
        });
    }
    onTabClose(tab, event) {
        event.stopPropagation();
        const tabCloseEvent = new TabCloseEvent(tab.index, tab);
        this.tabClose.emit(tabCloseEvent);
    }
    startScrolling(element, direction, type) {
        const timeFunction = type === "single" ? timer : interval;
        timeFunction(60)
            .pipe(takeUntil(this.scroll$))
            .subscribe(() => {
            let left = 0;
            switch (direction) {
                case "left":
                    left = Math.max(element.scrollLeft - 100, 0);
                    element.scrollTo({ left, behavior: "smooth" });
                    break;
                case "right":
                    left = Math.min(element.scrollLeft + 100, element.scrollWidth);
                    element.scrollTo({ left, behavior: "smooth" });
                    break;
            }
        });
    }
    stopScrolling() {
        this.scroll$.next();
        this.scroll$.complete();
        this.scroll$ = new Subject();
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.0.0", ngImport: i0, type: TabStripComponent, deps: [{ token: i0.ChangeDetectorRef }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "16.0.0", type: TabStripComponent, selector: "mona-tab-strip", inputs: { closable: "closable", keepTabContent: "keepTabContent" }, outputs: { tabClose: "tabClose" }, queries: [{ propertyName: "tabComponents", predicate: TabComponent }], ngImport: i0, template: "<div class=\"mona-tab-strip\">\n    <div class=\"mona-tab-strip-tabs\">\n        <div class=\"mona-tab-strip-scroll\">\n            <button monaButton (click)=\"startScrolling(tabListElement, 'left', 'single')\"\n                    (mousedown)=\"startScrolling(tabListElement, 'left', 'continuous')\" (mouseup)=\"stopScrolling()\">\n                <fa-icon [icon]=\"scrollLeftIcon\"></fa-icon>\n            </button>\n        </div>\n        <ul class=\"mona-tab-list\" #tabListElement>\n            <li *ngFor=\"let tab of tabComponents\" [ngClass]=\"{'mona-tab-active': tab.selected, 'mona-disabled': tab.disabled}\"\n                (click)=\"onTabClick(tab, tabListElement)\">\n                <div class=\"mona-tab-title\">\n                    <span *ngIf=\"!tab.titleTemplate\">{{tab.title}}</span>\n                    <ng-container [ngTemplateOutlet]=\"tab.titleTemplate\" *ngIf=\"!!tab.titleTemplate\"></ng-container>\n                </div>\n                <button monaButton [flat]=\"true\" [disabled]=\"tab.disabled\" *ngIf=\"(tab.closable===true) || (closable && tab.closable==null)\" class=\"mona-tab-close\" (click)=\"onTabClose(tab, $event)\">\n                    <fa-icon [icon]=\"tabCloseIcon\"></fa-icon>\n                </button>\n            </li>\n        </ul>\n        <div class=\"mona-tab-strip-scroll\">\n            <button monaButton (click)=\"startScrolling(tabListElement, 'right', 'single')\"\n                    (mousedown)=\"startScrolling(tabListElement, 'right', 'continuous')\" (mouseup)=\"stopScrolling()\">\n                <fa-icon [icon]=\"scrollRightIcon\"></fa-icon>\n            </button>\n        </div>\n    </div>\n    <ng-container *ngFor=\"let tab of tabComponents\">\n        <div class=\"mona-tab-content\" [ngClass]=\"{'mona-tab-hidden': keepTabContent && !tab.selected}\"\n             *ngIf=\"keepTabContent || tab.selected\">\n            <ng-container [ngTemplateOutlet]=\"tab.contentTemplate\"></ng-container>\n        </div>\n    </ng-container>\n</div>\n", styles: [":host{width:100%;height:100%}div.mona-tab-strip{width:100%;height:100%;border:1px solid var(--mona-border-color)}div.mona-tab-strip-tabs{width:100%;height:var(--mona-input-height);background:1px solid var(--mona-background-dark);border-bottom:1px solid var(--mona-border-color);display:flex}ul.mona-tab-list{list-style-type:none;width:100%;height:100%;display:flex;cursor:default;-webkit-user-select:none;user-select:none;font-size:12px;white-space:nowrap;overflow:hidden;background:var(--mona-background-dark)}ul.mona-tab-list li{list-style-type:none;height:100%;display:flex;align-items:center;justify-content:center;color:var(--mona-text);border-right:1px solid var(--mona-border-color);cursor:pointer}ul.mona-tab-list li.mona-tab-active{font-weight:700;background:var(--mona-background);color:var(--mona-primary)}ul.mona-tab-list li button.mona-tab-close{display:flex;align-items:center;justify-content:center}ul.mona-tab-list li button.mona-tab-close fa-icon{margin-top:2px}div.mona-tab-title{padding:5px 10px}div.mona-tab-strip-scroll{width:var(--mona-input-height);height:100%;display:flex;align-items:center;justify-content:center;background:var(--mona-background-dark);color:var(--mona-text)}div.mona-tab-strip-scroll button[monaButton]{width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:transparent;border:none;color:var(--mona-text);cursor:pointer;box-shadow:none}div.mona-tab-strip-scroll button[monaButton]:hover{background:var(--mona-background-darker)}div.mona-tab-content{width:100%;height:calc(100% - var(--mona-input-height));background:var(--mona-background-light);overflow:auto}div.mona-tab-hidden{display:none}\n"], dependencies: [{ kind: "directive", type: i1.NgClass, selector: "[ngClass]", inputs: ["class", "ngClass"] }, { kind: "directive", type: i1.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i1.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "directive", type: i1.NgTemplateOutlet, selector: "[ngTemplateOutlet]", inputs: ["ngTemplateOutletContext", "ngTemplateOutlet", "ngTemplateOutletInjector"] }, { kind: "component", type: i2.FaIconComponent, selector: "fa-icon", inputs: ["icon", "title", "spin", "pulse", "mask", "styles", "flip", "size", "pull", "border", "inverse", "symbol", "rotate", "fixedWidth", "classes", "transform", "a11yRole"] }, { kind: "directive", type: i3.ButtonDirective, selector: "[monaButton]", inputs: ["disabled", "flat", "primary", "selected", "toggleable"], outputs: ["selectedChange"] }] }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.0.0", ngImport: i0, type: TabStripComponent, decorators: [{
            type: Component,
            args: [{ selector: "mona-tab-strip", template: "<div class=\"mona-tab-strip\">\n    <div class=\"mona-tab-strip-tabs\">\n        <div class=\"mona-tab-strip-scroll\">\n            <button monaButton (click)=\"startScrolling(tabListElement, 'left', 'single')\"\n                    (mousedown)=\"startScrolling(tabListElement, 'left', 'continuous')\" (mouseup)=\"stopScrolling()\">\n                <fa-icon [icon]=\"scrollLeftIcon\"></fa-icon>\n            </button>\n        </div>\n        <ul class=\"mona-tab-list\" #tabListElement>\n            <li *ngFor=\"let tab of tabComponents\" [ngClass]=\"{'mona-tab-active': tab.selected, 'mona-disabled': tab.disabled}\"\n                (click)=\"onTabClick(tab, tabListElement)\">\n                <div class=\"mona-tab-title\">\n                    <span *ngIf=\"!tab.titleTemplate\">{{tab.title}}</span>\n                    <ng-container [ngTemplateOutlet]=\"tab.titleTemplate\" *ngIf=\"!!tab.titleTemplate\"></ng-container>\n                </div>\n                <button monaButton [flat]=\"true\" [disabled]=\"tab.disabled\" *ngIf=\"(tab.closable===true) || (closable && tab.closable==null)\" class=\"mona-tab-close\" (click)=\"onTabClose(tab, $event)\">\n                    <fa-icon [icon]=\"tabCloseIcon\"></fa-icon>\n                </button>\n            </li>\n        </ul>\n        <div class=\"mona-tab-strip-scroll\">\n            <button monaButton (click)=\"startScrolling(tabListElement, 'right', 'single')\"\n                    (mousedown)=\"startScrolling(tabListElement, 'right', 'continuous')\" (mouseup)=\"stopScrolling()\">\n                <fa-icon [icon]=\"scrollRightIcon\"></fa-icon>\n            </button>\n        </div>\n    </div>\n    <ng-container *ngFor=\"let tab of tabComponents\">\n        <div class=\"mona-tab-content\" [ngClass]=\"{'mona-tab-hidden': keepTabContent && !tab.selected}\"\n             *ngIf=\"keepTabContent || tab.selected\">\n            <ng-container [ngTemplateOutlet]=\"tab.contentTemplate\"></ng-container>\n        </div>\n    </ng-container>\n</div>\n", styles: [":host{width:100%;height:100%}div.mona-tab-strip{width:100%;height:100%;border:1px solid var(--mona-border-color)}div.mona-tab-strip-tabs{width:100%;height:var(--mona-input-height);background:1px solid var(--mona-background-dark);border-bottom:1px solid var(--mona-border-color);display:flex}ul.mona-tab-list{list-style-type:none;width:100%;height:100%;display:flex;cursor:default;-webkit-user-select:none;user-select:none;font-size:12px;white-space:nowrap;overflow:hidden;background:var(--mona-background-dark)}ul.mona-tab-list li{list-style-type:none;height:100%;display:flex;align-items:center;justify-content:center;color:var(--mona-text);border-right:1px solid var(--mona-border-color);cursor:pointer}ul.mona-tab-list li.mona-tab-active{font-weight:700;background:var(--mona-background);color:var(--mona-primary)}ul.mona-tab-list li button.mona-tab-close{display:flex;align-items:center;justify-content:center}ul.mona-tab-list li button.mona-tab-close fa-icon{margin-top:2px}div.mona-tab-title{padding:5px 10px}div.mona-tab-strip-scroll{width:var(--mona-input-height);height:100%;display:flex;align-items:center;justify-content:center;background:var(--mona-background-dark);color:var(--mona-text)}div.mona-tab-strip-scroll button[monaButton]{width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:transparent;border:none;color:var(--mona-text);cursor:pointer;box-shadow:none}div.mona-tab-strip-scroll button[monaButton]:hover{background:var(--mona-background-darker)}div.mona-tab-content{width:100%;height:calc(100% - var(--mona-input-height));background:var(--mona-background-light);overflow:auto}div.mona-tab-hidden{display:none}\n"] }]
        }], ctorParameters: function () { return [{ type: i0.ChangeDetectorRef }]; }, propDecorators: { closable: [{
                type: Input
            }], keepTabContent: [{
                type: Input
            }], tabClose: [{
                type: Output
            }], tabComponents: [{
                type: ContentChildren,
                args: [TabComponent]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFiLXN0cmlwLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL21vbmEtdWkvc3JjL2xpYi9sYXlvdXQvbW9kdWxlcy90YWItc3RyaXAvY29tcG9uZW50cy90YWItc3RyaXAvdGFiLXN0cmlwLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL21vbmEtdWkvc3JjL2xpYi9sYXlvdXQvbW9kdWxlcy90YWItc3RyaXAvY29tcG9uZW50cy90YWItc3RyaXAvdGFiLXN0cmlwLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFJSCxTQUFTLEVBQ1QsZUFBZSxFQUNmLFlBQVksRUFDWixLQUFLLEVBR0wsTUFBTSxFQUNOLFNBQVMsRUFDWixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDcEQsT0FBTyxFQUFFLFFBQVEsRUFBRSxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUUzRCxPQUFPLEVBQ0gsYUFBYSxFQUNiLGNBQWMsRUFHZCxPQUFPLEVBRVYsTUFBTSxtQ0FBbUMsQ0FBQztBQUMzQyxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sMEJBQTBCLENBQUM7Ozs7O0FBT3pELE1BQU0sT0FBTyxpQkFBaUI7SUFvQjFCLFlBQW9DLEdBQXNCO1FBQXRCLFFBQUcsR0FBSCxHQUFHLENBQW1CO1FBbkJ6QyxzQkFBaUIsR0FBa0IsSUFBSSxPQUFPLEVBQVEsQ0FBQztRQUNoRSxZQUFPLEdBQWtCLElBQUksT0FBTyxFQUFRLENBQUM7UUFDckMsbUJBQWMsR0FBbUIsYUFBYSxDQUFDO1FBQy9DLG9CQUFlLEdBQW1CLGNBQWMsQ0FBQztRQUNqRCxpQkFBWSxHQUFtQixPQUFPLENBQUM7UUFDdkQscUNBQXFD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Q0FBQyxDQUFDO29CQUMvQyxNQUFNO2dCQUNWLEtBQUssT0FBTztvQkFDUixJQUFJLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsVUFBVSxHQUFHLEdBQUcsRUFBRSxPQUFPLENBQUMsV0FBVyxDQUFDLENBQUM7b0JBQy9ELE9BQU8sQ0FBQyxRQUFRLENBQUMsRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxDQUFDLENBQUM7b0JBQy9DLE1BQU07YUFDYjtRQUNMLENBQUMsQ0FBQyxDQUFDO0lBQ1gsQ0FBQztJQUVNLGFBQWE7UUFDaEIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUNwQixJQUFJLENBQUMsT0FBTyxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBQ3hCLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxPQUFPLEVBQVEsQ0FBQztJQUN2QyxDQUFDOzhHQXRGUSxpQkFBaUI7a0dBQWpCLGlCQUFpQiwyTEFpQlQsWUFBWSw2QkNoRGpDLHMrREFrQ0E7OzJGREhhLGlCQUFpQjtrQkFMN0IsU0FBUzsrQkFDSSxnQkFBZ0I7d0dBYW5CLFFBQVE7c0JBRGQsS0FBSztnQkFJQyxjQUFjO3NCQURwQixLQUFLO2dCQUlDLFFBQVE7c0JBRGQsTUFBTTtnQkFJQSxhQUFhO3NCQURuQixlQUFlO3VCQUFDLFlBQVkiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICAgIEFmdGVyQ29udGVudEluaXQsXG4gICAgQWZ0ZXJWaWV3SW5pdCxcbiAgICBDaGFuZ2VEZXRlY3RvclJlZixcbiAgICBDb21wb25lbnQsXG4gICAgQ29udGVudENoaWxkcmVuLFxuICAgIEV2ZW50RW1pdHRlcixcbiAgICBJbnB1dCxcbiAgICBPbkRlc3Ryb3ksXG4gICAgT25Jbml0LFxuICAgIE91dHB1dCxcbiAgICBRdWVyeUxpc3Rcbn0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcbmltcG9ydCB7IFRhYkNvbXBvbmVudCB9IGZyb20gXCIuLi90YWIvdGFiLmNvbXBvbmVudFwiO1xuaW1wb3J0IHsgaW50ZXJ2YWwsIFN1YmplY3QsIHRha2VVbnRpbCwgdGltZXIgfSBmcm9tIFwicnhqc1wiO1xuaW1wb3J0IHsgU2Nyb2xsRGlyZWN0aW9uIH0gZnJvbSBcIi4uLy4uL2RhdGEvU2Nyb2xsRGlyZWN0aW9uXCI7XG5pbXBvcnQge1xuICAgIGZhQ2hldnJvbkxlZnQsXG4gICAgZmFDaGV2cm9uUmlnaHQsXG4gICAgZmFUaW1lcyxcbiAgICBmYVRpbWVzQ2lyY2xlLFxuICAgIGZhWG1hcmssXG4gICAgSWNvbkRlZmluaXRpb25cbn0gZnJvbSBcIkBmb3J0YXdlc29tZS9mcmVlLXNvbGlkLXN2Zy1pY29uc1wiO1xuaW1wb3J0IHsgVGFiQ2xvc2VFdmVudCB9IGZyb20gXCIuLi8uLi9kYXRhL1RhYkNsb3NlRXZlbnRcIjtcblxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6IFwibW9uYS10YWItc3RyaXBcIixcbiAgICB0ZW1wbGF0ZVVybDogXCIuL3RhYi1zdHJpcC5jb21wb25lbnQuaHRtbFwiLFxuICAgIHN0eWxlVXJsczogW1wiLi90YWItc3RyaXAuY29tcG9uZW50LnNjc3NcIl1cbn0pXG5leHBvcnQgY2xhc3MgVGFiU3RyaXBDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIEFmdGVyQ29udGVudEluaXQsIE9uRGVzdHJveSwgQWZ0ZXJWaWV3SW5pdCB7XG4gICAgcHJpdmF0ZSByZWFkb25seSBjb21wb25lbnREZXN0cm95JDogU3ViamVjdDx2b2lkPiA9IG5ldyBTdWJqZWN0PHZvaWQ+KCk7XG4gICAgcHJpdmF0ZSBzY3JvbGwkOiBTdWJqZWN0PHZvaWQ+ID0gbmV3IFN1YmplY3Q8dm9pZD4oKTtcbiAgICBwdWJsaWMgcmVhZG9ubHkgc2Nyb2xsTGVmdEljb246IEljb25EZWZpbml0aW9uID0gZmFDaGV2cm9uTGVmdDtcbiAgICBwdWJsaWMgcmVhZG9ubHkgc2Nyb2xsUmlnaHRJY29uOiBJY29uRGVmaW5pdGlvbiA9IGZhQ2hldnJvblJpZ2h0O1xuICAgIHB1YmxpYyByZWFkb25seSB0YWJDbG9zZUljb246IEljb25EZWZpbml0aW9uID0gZmFYbWFyaztcbiAgICAvLyBwdWJsaWMgc2VsZWN0ZWRUYWI/OiBUYWJDb21wb25lbnQ7XG5cbiAgICBASW5wdXQoKVxuICAgIHB1YmxpYyBjbG9zYWJsZTogYm9vbGVhbiA9IGZhbHNlO1xuXG4gICAgQElucHV0KClcbiAgICBwdWJsaWMga2VlcFRhYkNvbnRlbnQ6IGJvb2xlYW4gPSBmYWxzZTtcblxuICAgIEBPdXRwdXQoKVxuICAgIHB1YmxpYyB0YWJDbG9zZTogRXZlbnRFbWl0dGVyPFRhYkNsb3NlRXZlbnQ+ID0gbmV3IEV2ZW50RW1pdHRlcjxUYWJDbG9zZUV2ZW50PigpO1xuXG4gICAgQENvbnRlbnRDaGlsZHJlbihUYWJDb21wb25lbnQpXG4gICAgcHVibGljIHRhYkNvbXBvbmVudHM6IFF1ZXJ5TGlzdDxUYWJDb21wb25lbnQ+ID0gbmV3IFF1ZXJ5TGlzdDxUYWJDb21wb25lbnQ+KCk7XG5cbiAgICBwdWJsaWMgY29uc3RydWN0b3IocHJpdmF0ZSByZWFkb25seSBjZHI6IENoYW5nZURldGVjdG9yUmVmKSB7fVxuXG4gICAgcHVibGljIG5nQWZ0ZXJDb250ZW50SW5pdCgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy50YWJDb21wb25lbnRzLmZvckVhY2goKHQsIHR4KSA9PiAodC5pbmRleCA9IHR4KSk7XG4gICAgICAgIHRoaXMudGFiQ29tcG9uZW50cy5jaGFuZ2VzXG4gICAgICAgICAgICAucGlwZSh0YWtlVW50aWwodGhpcy5jb21wb25lbnREZXN0cm95JCkpXG4gICAgICAgICAgICAuc3Vic2NyaWJlKCh0YWJzOiBRdWVyeUxpc3Q8VGFiQ29tcG9uZW50PikgPT4ge1xuICAgICAgICAgICAgICAgIHRhYnMuZm9yRWFjaCgodCwgdHgpID0+ICh0LmluZGV4ID0gdHgpKTtcbiAgICAgICAgICAgIH0pO1xuICAgIH1cblxuICAgIHB1YmxpYyBuZ0FmdGVyVmlld0luaXQoKTogdm9pZCB7XG4gICAgICAgIC8vIHRoaXMuc2VsZWN0ZWRUYWIgPSB0aGlzLnRhYkNvbXBvbmVudHMuZmluZCh0ID0+IHQuc2VsZWN0ZWQpXG4gICAgICAgIC8vIGlmICh0aGlzLnNlbGVjdGVkVGFiKSB7XG4gICAgICAgIC8vICAgICB0aGlzLnNlbGVjdGVkVGFiLmFjdGl2ZSA9IHRydWU7XG4gICAgICAgIC8vIH1cbiAgICAgICAgdGhpcy5jZHIuZGV0ZWN0Q2hhbmdlcygpO1xuICAgIH1cblxuICAgIHB1YmxpYyBuZ09uRGVzdHJveSgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5jb21wb25lbnREZXN0cm95JC5uZXh0KCk7XG4gICAgICAgIHRoaXMuY29tcG9uZW50RGVzdHJveSQuY29tcGxldGUoKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgbmdPbkluaXQoKTogdm9pZCB7fVxuXG4gICAgcHVibGljIG9uVGFiQ2xpY2sodGFiOiBUYWJDb21wb25lbnQsIHRhYkxpc3RFbGVtZW50OiBIVE1MVUxpc3RFbGVtZW50KTogdm9pZCB7XG4gICAgICAgIHRoaXMudGFiQ29tcG9uZW50cy5mb3JFYWNoKHQgPT4gKHQuc2VsZWN0ZWQgPSBmYWxzZSkpO1xuICAgICAgICB0YWIuc2VsZWN0ZWQgPSB0cnVlO1xuICAgICAgICB3aW5kb3cuc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBsaXN0RWxlbWVudCA9IHRhYkxpc3RFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCJsaS5tb25hLXRhYi1hY3RpdmVcIik7XG4gICAgICAgICAgICBpZiAobGlzdEVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICBsaXN0RWxlbWVudC5zY3JvbGxJbnRvVmlldyh7IGJlaGF2aW9yOiBcInNtb290aFwiLCBibG9jazogXCJjZW50ZXJcIiB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHVibGljIG9uVGFiQ2xvc2UodGFiOiBUYWJDb21wb25lbnQsIGV2ZW50OiBNb3VzZUV2ZW50KTogdm9pZCB7XG4gICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICBjb25zdCB0YWJDbG9zZUV2ZW50ID0gbmV3IFRhYkNsb3NlRXZlbnQodGFiLmluZGV4LCB0YWIpO1xuICAgICAgICB0aGlzLnRhYkNsb3NlLmVtaXQodGFiQ2xvc2VFdmVudCk7XG4gICAgfVxuXG4gICAgcHVibGljIHN0YXJ0U2Nyb2xsaW5nKGVsZW1lbnQ6IEhUTUxFbGVtZW50LCBkaXJlY3Rpb246IFNjcm9sbERpcmVjdGlvbiwgdHlwZTogXCJzaW5nbGVcIiB8IFwiY29udGludW91c1wiKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IHRpbWVGdW5jdGlvbiA9IHR5cGUgPT09IFwic2luZ2xlXCIgPyB0aW1lciA6IGludGVydmFsO1xuICAgICAgICB0aW1lRnVuY3Rpb24oNjApXG4gICAgICAgICAgICAucGlwZSh0YWtlVW50aWwodGhpcy5zY3JvbGwkKSlcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICAgICAgICAgIGxldCBsZWZ0OiBudW1iZXIgPSAwO1xuICAgICAgICAgICAgICAgIHN3aXRjaCAoZGlyZWN0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJsZWZ0XCI6XG4gICAgICAgICAgICAgICAgICAgICAgICBsZWZ0ID0gTWF0aC5tYXgoZWxlbWVudC5zY3JvbGxMZWZ0IC0gMTAwLCAwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuc2Nyb2xsVG8oeyBsZWZ0LCBiZWhhdmlvcjogXCJzbW9vdGhcIiB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwicmlnaHRcIjpcbiAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQgPSBNYXRoLm1pbihlbGVtZW50LnNjcm9sbExlZnQgKyAxMDAsIGVsZW1lbnQuc2Nyb2xsV2lkdGgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5zY3JvbGxUbyh7IGxlZnQsIGJlaGF2aW9yOiBcInNtb290aFwiIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHVibGljIHN0b3BTY3JvbGxpbmcoKTogdm9pZCB7XG4gICAgICAgIHRoaXMuc2Nyb2xsJC5uZXh0KCk7XG4gICAgICAgIHRoaXMuc2Nyb2xsJC5jb21wbGV0ZSgpO1xuICAgICAgICB0aGlzLnNjcm9sbCQgPSBuZXcgU3ViamVjdDx2b2lkPigpO1xuICAgIH1cbn1cbiIsIjxkaXYgY2xhc3M9XCJtb25hLXRhYi1zdHJpcFwiPlxuICAgIDxkaXYgY2xhc3M9XCJtb25hLXRhYi1zdHJpcC10YWJzXCI+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJtb25hLXRhYi1zdHJpcC1zY3JvbGxcIj5cbiAgICAgICAgICAgIDxidXR0b24gbW9uYUJ1dHRvbiAoY2xpY2spPVwic3RhcnRTY3JvbGxpbmcodGFiTGlzdEVsZW1lbnQsICdsZWZ0JywgJ3NpbmdsZScpXCJcbiAgICAgICAgICAgICAgICAgICAgKG1vdXNlZG93bik9XCJzdGFydFNjcm9sbGluZyh0YWJMaXN0RWxlbWVudCwgJ2xlZnQnLCAnY29udGludW91cycpXCIgKG1vdXNldXApPVwic3RvcFNjcm9sbGluZygpXCI+XG4gICAgICAgICAgICAgICAgPGZhLWljb24gW2ljb25dPVwic2Nyb2xsTGVmdEljb25cIj48L2ZhLWljb24+XG4gICAgICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDx1bCBjbGFzcz1cIm1vbmEtdGFiLWxpc3RcIiAjdGFiTGlzdEVsZW1lbnQ+XG4gICAgICAgICAgICA8bGkgKm5nRm9yPVwibGV0IHRhYiBvZiB0YWJDb21wb25lbnRzXCIgW25nQ2xhc3NdPVwieydtb25hLXRhYi1hY3RpdmUnOiB0YWIuc2VsZWN0ZWQsICdtb25hLWRpc2FibGVkJzogdGFiLmRpc2FibGVkfVwiXG4gICAgICAgICAgICAgICAgKGNsaWNrKT1cIm9uVGFiQ2xpY2sodGFiLCB0YWJMaXN0RWxlbWVudClcIj5cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwibW9uYS10YWItdGl0bGVcIj5cbiAgICAgICAgICAgICAgICAgICAgPHNwYW4gKm5nSWY9XCIhdGFiLnRpdGxlVGVtcGxhdGVcIj57e3RhYi50aXRsZX19PC9zcGFuPlxuICAgICAgICAgICAgICAgICAgICA8bmctY29udGFpbmVyIFtuZ1RlbXBsYXRlT3V0bGV0XT1cInRhYi50aXRsZVRlbXBsYXRlXCIgKm5nSWY9XCIhIXRhYi50aXRsZVRlbXBsYXRlXCI+PC9uZy1jb250YWluZXI+XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgPGJ1dHRvbiBtb25hQnV0dG9uIFtmbGF0XT1cInRydWVcIiBbZGlzYWJsZWRdPVwidGFiLmRpc2FibGVkXCIgKm5nSWY9XCIodGFiLmNsb3NhYmxlPT09dHJ1ZSkgfHwgKGNsb3NhYmxlICYmIHRhYi5jbG9zYWJsZT09bnVsbClcIiBjbGFzcz1cIm1vbmEtdGFiLWNsb3NlXCIgKGNsaWNrKT1cIm9uVGFiQ2xvc2UodGFiLCAkZXZlbnQpXCI+XG4gICAgICAgICAgICAgICAgICAgIDxmYS1pY29uIFtpY29uXT1cInRhYkNsb3NlSWNvblwiPjwvZmEtaWNvbj5cbiAgICAgICAgICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgICAgIDwvbGk+XG4gICAgICAgIDwvdWw+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJtb25hLXRhYi1zdHJpcC1zY3JvbGxcIj5cbiAgICAgICAgICAgIDxidXR0b24gbW9uYUJ1dHRvbiAoY2xpY2spPVwic3RhcnRTY3JvbGxpbmcodGFiTGlzdEVsZW1lbnQsICdyaWdodCcsICdzaW5nbGUnKVwiXG4gICAgICAgICAgICAgICAgICAgIChtb3VzZWRvd24pPVwic3RhcnRTY3JvbGxpbmcodGFiTGlzdEVsZW1lbnQsICdyaWdodCcsICdjb250aW51b3VzJylcIiAobW91c2V1cCk9XCJzdG9wU2Nyb2xsaW5nKClcIj5cbiAgICAgICAgICAgICAgICA8ZmEtaWNvbiBbaWNvbl09XCJzY3JvbGxSaWdodEljb25cIj48L2ZhLWljb24+XG4gICAgICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG4gICAgPG5nLWNvbnRhaW5lciAqbmdGb3I9XCJsZXQgdGFiIG9mIHRhYkNvbXBvbmVudHNcIj5cbiAgICAgICAgPGRpdiBjbGFzcz1cIm1vbmEtdGFiLWNvbnRlbnRcIiBbbmdDbGFzc109XCJ7J21vbmEtdGFiLWhpZGRlbic6IGtlZXBUYWJDb250ZW50ICYmICF0YWIuc2VsZWN0ZWR9XCJcbiAgICAgICAgICAgICAqbmdJZj1cImtlZXBUYWJDb250ZW50IHx8IHRhYi5zZWxlY3RlZFwiPlxuICAgICAgICAgICAgPG5nLWNvbnRhaW5lciBbbmdUZW1wbGF0ZU91dGxldF09XCJ0YWIuY29udGVudFRlbXBsYXRlXCI+PC9uZy1jb250YWluZXI+XG4gICAgICAgIDwvZGl2PlxuICAgIDwvbmctY29udGFpbmVyPlxuPC9kaXY+XG4iXX0=