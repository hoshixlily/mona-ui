<div class="mona-tree-view" tabindex="0">
    <ul class="mona-tree-list" cdkDropList [cdkDropListSortingDisabled]="true"
        (cdkDropListDropped)="onNodeDrop($event)">
        <ng-template #treeTemplate let-nodes>
            <ng-container *ngFor="let node of nodes; let nx = index; trackBy:nodeTrackBy;">
                <li class="mona-tree-list-item" cdkDrag [cdkDragData]="node" (cdkDragStarted)="onNodeDragStart($event)"
                    (cdkDragEnded)="onNodeDragEnd($event)" (cdkDragMoved)="onNodeDragMove($event, node)">
                    <mona-tree-view-node [node]="node" [nodeTextTemplate]="nodeTextTemplate" [dragging]="dragging"
                                         (dropPositionChange)="onNodeDropPositionChange($event)"
                                         (nodeSelect)="onNodeSelect($event)"
                                         (nodeClick)="nodeClick.emit($event)"
                                         (nodeDoubleClick)="nodeDoubleClick.emit($event)"></mona-tree-view-node>
                    <ul class="mona-subtree-list" [@nodeExpand]="node.expanded"
                        *ngIf="!treeViewService.expandableOptions.enabled
                        || (treeViewService.expandableOptions.enabled && (node.nodes.length !== 0 && node.expanded))">
                        <ng-container [ngTemplateOutlet]="treeTemplate"
                                      [ngTemplateOutletContext]="{$implicit: node.nodes}"></ng-container>
                    </ul>
                    <ng-template cdkDragPreview [data]="node">
                        <div class="mona-tree-view-node-dragging">
                            <span>
                                <ng-container *ngIf="dropPosition==='inside'">
                                    <fa-icon [icon]="dropInsideIcon"></fa-icon>
                                </ng-container>
                                <ng-container *ngIf="dropPosition==='after'">
                                    <fa-icon [icon]="dropAfterIcon"></fa-icon>
                                </ng-container>
                                <ng-container *ngIf="dropPosition==='before'">
                                    <fa-icon [icon]="dropBeforeIcon"></fa-icon>
                                </ng-container>
                            </span>
                            <span>{{node.text}}</span>
                        </div>
                    </ng-template>
                </li>
            </ng-container>
        </ng-template>
        <ng-container [ngTemplateOutlet]="treeTemplate"
                      [ngTemplateOutletContext]="{$implicit: treeViewService.viewNodeList}"></ng-container>
    </ul>
</div>
