<div class="mona-dropdown mona-multi-select mona-input-selector" [attr.tabindex]="disabled ? -1 : 0"
     [ngClass]="{'mona-disabled': disabled}"  (click)="open()"
     #multiSelectWrapper>
    <div class="mona-input-selector-value">
        <div>
            <mona-chip *ngFor="let item of selectedListItems | slice:0:visibleTagCount"
                       [tabindex]="-1" [removable]="true" (remove)="onSelectedItemRemove($event, item)">
                <span *ngIf="!tagTemplate">{{item.text}}</span>
                <ng-container [ngTemplateOutlet]="tagTemplate" [ngTemplateOutletContext]="{$implicit: item.data}" *ngIf="tagTemplate"></ng-container>
            </mona-chip>
            <mona-chip [tabindex]="-1" [removable]="true" (remove)="onSelectedItemGroupRemove($event)"
                       *ngIf="tagCount >= 0 && selectedListItems.length > tagCount">
                <span *ngIf="!summaryTagTemplate">{{summaryTagText}}</span>
                <ng-container [ngTemplateOutlet]="summaryTagTemplate" [ngTemplateOutletContext]="{$implicit: selectedListItems}"
                              *ngIf="summaryTagTemplate"></ng-container>
            </mona-chip>
        </div>
    </div>
    <div class="mona-input-selector-icon">
        <fa-icon [icon]="dropdownIcon"></fa-icon>
    </div>
</div>

<ng-template #multiSelectPopupTemplate>
    <div *ngIf="filterable">
        <mona-text-box class="filter-box" [ngModel]="filterText" (ngModelChange)="filterChange$.next($event)"
                       (keydown)="filterKeydown$.next($event)">
            <ng-template monaTextBoxPrefixTemplate>
                <fa-icon [icon]="filterIcon"></fa-icon>
            </ng-template>
        </mona-text-box>
    </div>
    <div>
        <mona-list [data]="viewData" [itemDisabler]="itemDisabler" [highlightedItem]="highlightedItem"
                   [highlightable]="true" selectionMode="multiple"
                   [value]="selectedListItems" (valueChange)="onSelectedListItemsChange($event)" #listComponent>
            <ng-container *ngIf="itemTemplate">
                <ng-template monaListItemTemplate let-dataItem let-listItem="listItem">
                    <ng-container [ngTemplateOutlet]="itemTemplate ?? null"
                                  [ngTemplateOutletContext]="{$implicit: dataItem, listItem}"></ng-container>
                </ng-template>
            </ng-container>
            <ng-container *ngIf="groupTemplate">
                <ng-template monaListGroupTemplate let-dataItem let-listItem="listItem">
                    <ng-container [ngTemplateOutlet]="groupTemplate ?? null"
                                  [ngTemplateOutletContext]="{$implicit: dataItem, listItem}"></ng-container>
                </ng-template>
            </ng-container>
        </mona-list>
    </div>
</ng-template>
