<div class="mona-grid-list">
    <div class="mona-grid-list-wrap">
        <table>
            <colgroup>
                <col *ngFor="let _ of gridService.groupColumns" style="width: 34px;">
                <col *ngFor="let column of gridService.columns"
                     [style.width.px]="column.calculatedWidth" [style.min-width.px]="column.minWidth">
            </colgroup>
            <tbody>
                <ng-container *ngIf="gridService.groupColumns.length === 0">
                    <tr *ngFor="let row of data" (click)="onGridRowClick($event, row)" [ngClass]="{'mona-selected': row.selected}">
                        <td *ngFor="let column of columns">
                            <mona-grid-cell [column]="column" [row]="row"></mona-grid-cell>
                        </td>
                    </tr>
                </ng-container>
                <ng-container *ngIf="gridService.groupColumns.length !== 0">
                    <ng-template #gridGroupTemplate let-groupData let-column="column" let-cx="cx" let-depth="depth">
                        <ng-container *ngIf="groupData|gridGroup:column:gridService.pageState.page as groupItem">
                            <ng-container *ngFor="let subGroup of groupItem">
                                <tr class="mona-grid-grouping-row">
                                    <td *ngFor="let _ of gridService.groupColumns|monaSlice:0:cx"></td>
                                    <td [colSpan]="columns.length + gridService.groupColumns.length"
                                        *ngIf="subGroup.rows.length > 0">
                                        <button monaButton [flat]="true" style="width: 34px;" (click)="onGroupExpandChange(subGroup)">
                                            <fa-icon [icon]="collapseIcon" *ngIf="!subGroup.collapsed"></fa-icon>
                                            <fa-icon [icon]="expandIcon" *ngIf="subGroup.collapsed"></fa-icon>
                                        </button>
                                        <span class="mona-grid-grouping-row-text">{{column.title}}: {{subGroup.rows[0].data[column.field]}}</span>
                                    </td>
                                </tr>

                                <ng-container *ngIf="cx < gridService.groupColumns.length-1 && !subGroup.collapsed">
                                    <ng-container [ngTemplateOutlet]="gridGroupTemplate"
                                                  [ngTemplateOutletContext]="{$implicit: subGroup.rows, column: gridService.groupColumns[cx+1], cx: cx+1, depth:depth+1}">
                                    </ng-container>
                                </ng-container>
                                <ng-container *ngIf="depth===gridService.groupColumns.length-1 && !subGroup.collapsed">
                                    <tr *ngFor="let row of subGroup.rows" (click)="onGridRowClick($event, row)" [ngClass]="{'mona-selected': row.selected}">
                                        <td *ngFor="let _ of gridService.groupColumns"></td>
                                        <td *ngFor="let column of columns">
                                            <mona-grid-cell [column]="column" [row]="row"></mona-grid-cell>
                                        </td>
                                    </tr>
                                </ng-container>
                            </ng-container>
                        </ng-container>
                    </ng-template>

                    <ng-container [ngTemplateOutlet]="gridGroupTemplate"
                                  [ngTemplateOutletContext]="{$implicit: data, column: gridService.groupColumns[0], cx: 0, depth: 0}"></ng-container>
                </ng-container>
            </tbody>
        </table>
    </div>
</div>
